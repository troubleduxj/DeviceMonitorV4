# 权限按钮显示模式配置说明

## 功能概述

系统现在支持通过**系统参数**来全局控制无权限按钮的显示方式，方便在开发调试和生产环境之间切换。

## 配置方式

### 1. 通过系统管理界面配置

1. 登录系统（使用管理员账户）
2. 进入 **系统管理 → 系统参数**
3. 找到参数 `PERMISSION_BUTTON_MODE`
4. 修改参数值：
   - `disable`：禁用模式（按钮显示但灰色不可点击）- **推荐用于开发调试**
   - `hide`：隐藏模式（按钮完全不显示）- **推荐用于生产环境**
5. 保存后刷新页面即可生效

### 2. 通过数据库直接修改

```sql
UPDATE t_sys_config 
SET param_value = 'disable'  -- 或 'hide'
WHERE param_key = 'PERMISSION_BUTTON_MODE';
```

## 两种模式对比

### 禁用模式（disable）

**特点**：
- ✅ 按钮显示但呈灰色，不可点击
- ✅ 用户可以看到所有功能，知道哪些功能需要权限
- ✅ 便于开发调试，快速识别权限配置问题
- ❌ 界面上会有很多灰色按钮，可能显得不够简洁

**适用场景**：
- 开发环境
- 测试环境
- 权限配置调试

### 隐藏模式（hide）

**特点**：
- ✅ 无权限的按钮完全不显示
- ✅ 界面简洁，只显示用户能使用的功能
- ✅ 更好的用户体验
- ❌ 用户不知道还有其他功能存在

**适用场景**：
- 生产环境
- 正式部署后的系统

## 优先级规则

系统支持三个层级的配置：

1. **组件级配置**（最高优先级）
   ```vue
   <PermissionButton 
     :hide-when-no-permission="true"
     permission="POST /api/v2/devices"
   >
     新建设备
   </PermissionButton>
   ```

2. **全局系统配置**（中等优先级）
   - 通过系统参数 `PERMISSION_BUTTON_MODE` 设置
   - 影响所有未明确指定配置的按钮

3. **默认值**（最低优先级）
   - 如果系统参数不存在，默认使用 `disable` 模式

## 示例场景

### 场景1：开发调试

```
系统参数设置：PERMISSION_BUTTON_MODE = disable
结果：所有无权限按钮显示但禁用，方便查看权限配置
```

### 场景2：生产环境

```
系统参数设置：PERMISSION_BUTTON_MODE = hide
结果：所有无权限按钮隐藏，界面简洁
```

### 场景3：混合模式

```
系统参数设置：PERMISSION_BUTTON_MODE = hide
特殊按钮：<PermissionButton :hide-when-no-permission="false" :disable-when-no-permission="true">
结果：大部分按钮隐藏，特殊按钮禁用显示
```

## 技术实现

### 后端

- 系统参数存储在 `t_sys_config` 表
- 参数键：`PERMISSION_BUTTON_MODE`
- 参数值：`hide` 或 `disable`

### 前端

- Composable：`usePermissionButtonMode`
- 组件：`PermissionButton`
- 自动从系统参数API加载配置
- 支持组件级覆盖

## 常见问题

### Q1: 修改配置后没有生效？

A: 需要刷新页面。系统参数在页面加载时读取。

### Q2: 某个按钮想要不同的行为？

A: 在组件上明确指定 `:hide-when-no-permission` 或 `:disable-when-no-permission` 属性。

### Q3: 如何恢复默认设置？

A: 将系统参数 `PERMISSION_BUTTON_MODE` 的值设置为 `disable`。

## 建议

1. **开发环境**：使用 `disable` 模式，方便调试权限配置
2. **测试环境**：使用 `disable` 模式，方便测试人员了解系统功能
3. **生产环境**：使用 `hide` 模式，提供更好的用户体验
4. **特殊按钮**：对于需要特殊处理的按钮，使用组件级配置覆盖全局设置
