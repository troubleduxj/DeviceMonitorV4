# 前端启动问题解决方案

## 问题描述

```
ERROR  error when starting dev server:
Error: listen EACCES: permission denied 127.0.0.1:5173
```

## 原因分析

Vite默认使用5173端口，可能遇到权限问题或端口被占用。

---

## 解决方案（3选1）

### ✅ 方案1：使用管理员权限运行（推荐）

1. **右键 PowerShell** → 选择 "以管理员身份运行"
2. 进入项目目录：
   ```powershell
   cd D:\Cursor\Project\DeviceMonitorV2_20251013_V1\DeviceMonitorV2\web
   ```
3. 启动前端：
   ```powershell
   npm run dev
   ```

或者直接双击：`start-dev-admin.bat`（右键→以管理员身份运行）

---

### ✅ 方案2：更换端口（简单快速）⭐

#### 步骤1：创建 `.env` 文件

在 `web` 目录下创建 `.env` 文件（如果文件创建被阻止，手动创建）：

```env
# 端口配置（使用3001避免权限问题）
VITE_PORT=3001

# 公共路径
VITE_PUBLIC_PATH=/

# 是否使用代理
VITE_USE_PROXY=true

# 后端API地址
VITE_BASE_API=http://localhost:8000
```

#### 步骤2：重新启动

```powershell
cd web
npm run dev
```

访问：http://localhost:3001

---

### ✅ 方案3：临时指定端口

直接在启动命令中指定端口：

```powershell
cd web
npx vite --port 3001 --host 127.0.0.1
```

---

## 推荐操作流程

### 快速方案（方案2）

1. 在 `web` 目录手动创建 `.env` 文件
2. 复制以下内容到文件：
   ```env
   VITE_PORT=3001
   VITE_USE_PROXY=true
   VITE_BASE_API=http://localhost:8000
   ```
3. 保存文件
4. 运行 `npm run dev`
5. 访问 http://localhost:3001

---

## 验证步骤

### 1. 后端验证（已完成✅）
```
✅ 后端运行在 http://localhost:8000
✅ API文档：http://localhost:8000/docs
```

### 2. 前端验证
```
✅ 前端开发服务器启动
✅ 访问 http://localhost:3001 或 http://localhost:5173
✅ 登录系统
✅ 查看左侧菜单是否有"数据模型管理"
```

### 3. 功能测试
- ✅ 模型配置管理页面
- ✅ 字段映射管理页面
- ✅ 数据预览页面

---

## 数据库菜单脚本

**⚠️ 重要**：在测试前端功能前，需要先执行数据库菜单脚本：

```powershell
# 在项目根目录
python database/migrations/device-data-model/execute_menu_migration.py
```

这会在数据库中创建新的菜单项。

---

## 完整启动流程

```bash
# 1. 启动后端（已完成✅）
python run.py

# 2. 执行菜单脚本（待执行⏳）
python database/migrations/device-data-model/execute_menu_migration.py

# 3. 启动前端（当前步骤）
cd web
npm run dev  # 方案1：管理员权限
# 或
npx vite --port 3001  # 方案3：临时端口

# 4. 访问系统
浏览器访问：http://localhost:3001 或 http://localhost:5173
```

---

## 常见问题

### Q1: 端口还是被占用？
```powershell
# 查找占用进程
netstat -ano | findstr :3001

# 结束进程（PID是上一步查到的进程ID）
taskkill /PID <PID> /F
```

### Q2: npm命令找不到？
```powershell
# 检查Node.js安装
node -v
npm -v

# 如果没有安装，下载安装Node.js LTS版本
```

### Q3: 模块找不到？
```powershell
# 重新安装依赖
cd web
npm install
```

---

## 技术说明

- **Vite默认端口**: 5173
- **项目配置端口**: 3001（通过VITE_PORT环境变量）
- **后端端口**: 8000
- **代理配置**: `/api` → `http://localhost:8000`

---

## 下一步

1. ✅ 选择任一方案启动前端
2. ⏳ 执行数据库菜单脚本
3. ⏳ 登录系统测试新功能
4. ⏳ 验证数据模型管理功能

**Phase 3 前端开发即将完成测试！** 🚀

