# 离线打包脚本使用说明

## 脚本文件

- **离线打包.bat** - 完整的离线部署包打包脚本

## 使用方法

### 1. 运行打包脚本

```cmd
scripts\离线打包.bat
```

### 2. 等待完成

脚本会自动完成以下步骤：
1. 检查环境（Python、Node.js）
2. 创建临时目录并安装 npm 依赖
3. 复制项目代码
4. 下载 Python 依赖包
5. 构建前端项目
6. 打包 node_modules
7. 创建部署脚本
8. 生成部署说明

### 3. 输出位置

打包完成后，部署包位于：
```
offline_deploy_complete/
```

## 打包内容

- ✅ 后端代码（app/）
- ✅ 前端代码（web/）
- ✅ 共享代码（packages/）
- ✅ 构建配置（web/build/）
- ✅ 国际化文件（web/i18n/）
- ✅ 设置文件（web/settings/）
- ✅ 环境配置（.env*）
- ✅ Python 依赖包（offline_packages/）
- ✅ 前端依赖包（web_node_modules.tar.gz）
- ✅ 数据库迁移（migrations/）
- ✅ 部署脚本（*.bat）

## 注意事项

1. **使用 npm 而非 pnpm**
   - 脚本会自动使用 npm 安装依赖
   - pnpm 的符号链接无法在离线环境使用

2. **前端构建**
   - 脚本会自动构建前端项目
   - 构建产物包含在部署包中

3. **完整性检查**
   - 脚本结束时会验证关键文件
   - 确保所有必要文件都已打包

## 故障排除

### 问题：npm 安装失败

**解决**：
```cmd
cd web
npm install
```

### 问题：前端构建失败

**解决**：
1. 检查 Vue 文件语法错误
2. 确保所有依赖已安装
3. 查看构建日志

### 问题：打包文件过大

**说明**：
- node_modules 压缩包约 150-200 MB
- 这是正常的，包含所有前端依赖

## 更新记录

- **2025-11-17** - 完善版本，包含所有必要文件和配置
- 修复了 pnpm 符号链接问题
- 添加了环境配置文件
- 优化了用户体验

## 相关文档

- [离线部署指南](../docs/离线部署指南-最终版.md)
