# 10 版本规划与迭代路线

## Beta V0.1 版本规划

**目标：** 实现系统核心框架搭建、基础支撑模块开发以及基础功能模块的前后端开发，并进行界面优化。

**主要功能模块：**

1.  **系统整体框架搭建（前后端）：**
    *   **前端：** 基于 Vue 3 + TypeScript + Ant Design Vue 构建项目基础结构，实现路由管理、状态管理、组件库集成等。
    *   **后端：** 基于 FastAPI 构建 RESTful API 服务，实现数据库连接、ORM 配置、基本认证授权框架等。

2.  **完善系统支撑基本模块的开发：**
    *   **用户与权限管理：** 实现用户注册、登录、角色管理、权限分配（基于 RBAC 模型）。
    *   **系统设置：** 提供基础的系统参数配置功能。

3.  **实现基础功能模块的前后端开发：**
    *   **登录：** 用户认证与授权，生成 JWT Token。
    *   **系统看板：** 展示关键设备数据概览、告警摘要等。
    *   **系统设置：** 包含用户管理、角色管理、菜单管理等。
    *   **设备信息：**
        *   **设备管理页：** 实现设备的增删改查、设备状态展示、搜索、筛选、批量操作。
        *   **设备实时监测页：** 展示单个设备的实时运行参数，支持参数选择和图表显示范围调整。
        *   **历史数据查询页：** 提供时间、设备、参数选择器，支持数据表格、历史曲线图展示和数据导出。
    *   **统计分析：**
        *   **设备在线率统计：** 展示设备在线率统计信息，通过图表直观呈现，支持时间范围选择、设备筛选和数据导出。
        *   **焊接时长统计：** 展示焊接时长统计信息，通过图表直观呈现，支持时间范围选择、设备筛选和数据导出。

4.  **系统的界面优化：**
    *   根据前端原型与交互说明，对已实现的功能页面进行 UI/UX 优化，提升用户体验。

**预期成果：**
*   一个可运行的、具备基本功能的设备监控系统原型。
*   前后端代码结构清晰，符合规范。
*   核心业务流程（登录、设备管理、数据展示）可正常运行。



## V0.2 版本规划

新增系统配套功能：

#### 1. 字典管理 (Dictionary Management)

__功能目标__: 提供可配置的、通用的数据字典，用于统一管理系统中的各种枚举值、状态码、类型等，减少硬编码，提高系统的灵活性和可维护性。

__设计思路__:

- __数据库层面__:

  - __`sys_dict_type` (字典类型表)__：用于定义字典的分类，例如 `device_status`（设备状态）、`alarm_type`（报警类型）。
    - 字段: `id` (主键), `type_code` (唯一标识，如 'device_status'), `type_name` (显示名称，如 '设备状态'), `description` (描述), `created_at`, `updated_at`。
  - __`sys_dict_data` (字典数据表)__：存储每个字典类型下的具体数据项。
    - 字段: `id` (主键), `dict_type_id` (外键关联 `sys_dict_type.id`), `data_label` (显示文本，如 '运行中'), `data_value` (实际值，如 'running'), `sort_order` (排序), `is_enabled` (是否启用), `created_at`, `updated_at`。

- __后端 (FastAPI)__：

  - __ORM 模型__: 在 `app/models/system.py` (或新建 `app/models/dict.py`) 中定义 `SysDictType` 和 `SysDictData` 的 Tortoise ORM 模型。

  - __Pydantic Schema__: 在 `app/schemas/system.py` (或新建 `app/schemas/dict.py`) 中定义对应的数据验证和序列化 Schema。

  - __Controller__: 在 `app/controllers/system.py` (或新建 `app/controllers/dict.py`) 中创建 `DictController`，提供对字典类型和字典数据的 CRUD (创建、读取、更新、删除) 操作。可以继承 `app/core/crud.py` 中的 `CRUDBase`。

  - __API 路由__: 在 `app/api/v1/system.py` (或新建 `app/api/v1/dict.py`) 中定义以下 RESTful API 接口：

    - `GET /api/v1/dict/types`: 获取所有字典类型。
    - `GET /api/v1/dict/data/{type_code}`: 根据字典类型编码获取对应的字典数据列表。
    - `POST /api/v1/dict/types`, `PUT /api/v1/dict/types/{id}`, `DELETE /api/v1/dict/types/{id}`: 字典类型的管理接口。
    - `POST /api/v1/dict/data`, `PUT /api/v1/dict/data/{id}`, `DELETE /api/v1/dict/data/{id}`: 字典数据的管理接口。

  - __缓存__: 考虑到字典数据通常不频繁变动但查询量大，可以考虑在后端对常用字典数据进行缓存 (例如使用 Redis)，以提高查询性能。

- __前端 (Vue.js)__：

  - __API 服务__: 在 `web/src/api/dict.js` 中封装对后端字典API的请求。
  - __页面__: 在 `web/src/views/system/dict/` 目录下创建 `DictTypeManagement.vue` 和 `DictDataManagement.vue` 页面，提供用户界面进行字典的增删改查。
  - __通用组件__: 开发一个通用的 `DictSelect` 或 `DictRadioGroup` 组件，接收 `type_code` 作为属性，自动从后端获取并渲染对应的字典选项，方便其他页面复用。

#### 2. 系统参数管理 (System Parameter Management)

__功能目标__: 提供一个集中管理系统运行时参数的机制，允许非开发人员在不修改代码和不重启服务的情况下调整系统行为（如日志级别、外部服务URL、某些功能开关）。

__设计思路__:

- __数据库层面__:
  - __`sys_config` (系统配置表)__：
    - 字段: `id` (主键), `param_key` (唯一标识，如 'LOG_LEVEL'), `param_value` (参数值，如 'INFO'), `param_name` (显示名称，如 '日志级别'), `param_type` (参数类型，如 'string', 'int', 'boolean'), `description` (描述), `is_editable` (是否允许前端编辑), `created_at`, `updated_at`。

- __后端 (FastAPI)__：

  - __ORM 模型__: 在 `app/models/system.py` 中定义 `SysConfig` 的 Tortoise ORM 模型。

  - __Pydantic Schema__: 在 `app/schemas/system.py` 中定义对应 Schema。

  - __Controller__: 在 `app/controllers/system.py` 中创建 `ConfigController`，提供对系统参数的读取和更新接口。

  - __API 路由__: 在 `app/api/v1/system.py` 中定义以下接口：

    - `GET /api/v1/config`: 获取所有系统参数列表。
    - `PUT /api/v1/config/{param_key}`: 更新指定 `param_key` 的参数值。

  - __运行时加载与刷新__:

    - 在应用启动时 (例如 `app/core/init_app.py` 中) 将所有 `is_editable=True` 的参数加载到内存中，并提供一个全局可访问的配置对象。
    - 实现一个机制，当参数在数据库中更新后，能够通知应用刷新内存中的配置，或者定期从数据库同步。
    - __安全__: `param_value` 字段可能包含敏感信息，需要考虑加密存储和传输。

- __前端 (Vue.js)__：

  - __API 服务__: 在 `web/src/api/config.js` 中封装对后端配置API的请求。
  - __页面__: 在 `web/src/views/system/config/` 目录下创建 `SystemConfigManagement.vue` 页面，根据 `param_type` 和 `is_editable` 动态生成表单，展示和编辑系统参数。

#### 3. 第三方API接入 (Third-party API Integration)

__功能目标__: 允许系统与外部服务（特别是Node-RED等IoT平台或数据处理服务）进行交互，发送数据或获取数据。

__设计思路__:

- __后端 (FastAPI) - 核心集成层__:

  - __新模块__: 在 `app/services/` 目录下创建 `external_api.py` (或 `node_red_service.py`)，专门处理与外部API的通信逻辑。
  - __HTTP 客户端__: 使用 `httpx` (项目中已存在，用于TDengine连接) 或 `aiohttp` 等异步HTTP客户端进行外部请求。
  - __配置化__: 外部API的 `base_url`、认证信息 (API Key, Token)、特定路径等应通&#x8FC7;__&#x7CFB;统参数管&#x7406;__&#x529F;能进行配置，而非硬编码。
  - __封装__: 为每个特定的外部API（例如Node-RED的某个特定流程）编写封装函数，处理请求构建、认证、响应解析和错误处理。
    - 示例函数: `trigger_node_red_flow(flow_id: str, payload: dict)`。
  - __异步处理__: 确保所有外部API调用都是异步的，避免阻塞主线程。
  - __错误处理与日志__: 详细记录外部API调用过程中的请求、响应和错误信息，便于排查问题。
  - __安全__: 确保敏感的认证信息在传输和存储过程中加密，不在前端直接暴露。

- __后端 (FastAPI) - 对外暴露层 (可选)__:

  - 如果某些第三方API需要由前端直接触发，或者需要对外部API的响应进行预处理，可以在 `app/api/v1/thirdparty.py` 中定义代理路由。
  - 这些代理路由会调用 `app/services/external_api.py` 中的函数，并对结果进行处理后返回给前端。
  - 例如: `POST /api/v1/thirdparty/node-red/trigger-flow`。

- __前端 (Vue.js)__：

  - __API 服务__: 在 `web/src/api/thirdparty.js` 中封装对后端代理API的请求。
  - __UI 组件__: 根据业务需求，在相应页面（如设备监控页面、数据报表页面）中添加按钮或组件，调用这些第三方API。例如，一个“重启设备”按钮，可能通过调用Node-RED API来触发实际操作。





## V0.3 版本规划

**目标：** 在 V0.1 基础上，逐步实现已设计但未在 V0.1 中包含的其它功能模块，如：


*   告警中心（高级功能）
*   AI 分析与预测
*   流程编排
*   更完善的数据可视化与报表功能
*   国际化支持
*   更全面的系统日志与审计功能

**迭代策略：**
*   采用敏捷开发模式，每个版本周期进行需求评审、开发、测试和发布。
*   持续收集用户反馈，优化现有功能并规划后续版本。
*   注重代码质量和可维护性，为后续功能扩展打下坚实基础。