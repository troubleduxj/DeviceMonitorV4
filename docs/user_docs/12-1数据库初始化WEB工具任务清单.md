# 12-1 数据库初始化WEB工具任务清单

## 项目概述
**项目名称**: 数据库初始化WEB工具
**目标**: 创建独立的Web工具解决数据库未创建时系统无法启动的问题
**技术栈**: FastAPI + Vue.js 3 + PostgreSQL/TDengine
**端口**: 8001（与主系统8000端口隔离）

---

## 📋 任务清单总览

### 🎯 阶段1: 项目初始化与基础架构 (优先级: 高)

#### 任务1.1: 创建项目目录结构
- **文件路径**: `tools/db-init-web/`
- **任务描述**: 创建完整的项目目录结构
- **创建目录**:
  - `tools/db-init-web/api/` - API路由
  - `tools/db-init-web/services/` - 业务逻辑
  - `tools/db-init-web/models/` - 数据模型
  - `tools/db-init-web/utils/` - 工具函数
  - `tools/db-init-web/static/` - 静态文件
  - `tools/db-init-web/templates/` - HTML模板
  - `tools/db-init-web/tests/` - 测试文件
- **Python环境**: 创建独立虚拟环境 `.venv/`，避免与主系统冲突
- **完成标准**: 所有目录创建完成，结构清晰，环境独立
- **预计耗时**: 15分钟

#### 任务1.2: 创建基础配置文件
- **文件路径**: `tools/db-init-web/config.py`
- **任务描述**: 创建应用配置文件
- **配置内容**:
  - 数据库连接配置
  - 日志配置
  - 安全设置
  - 端口配置（8001）
- **完成标准**: 配置文件完整，包含所有必要参数
- **预计耗时**: 20分钟

#### 任务1.2: 创建Python依赖文件
- **文件路径**: `tools/db-init-web/requirements.txt`
- **任务描述**: 创建Python依赖配置文件 (独立环境)
- **环境说明**: 独立Python虚拟环境，与主系统完全隔离
- **核心依赖**:
  - fastapi==0.104.1
  - uvicorn==0.24.0
  - sqlalchemy==2.0.23
  - asyncpg==0.29.0
  - pydantic==2.5.0
  - python-dotenv==1.0.0
  - aiofiles==23.2.1
- **安装命令**:
  ```bash
  cd tools/db-init-web
  python -m venv .venv
  .venv\Scripts\activate  # Windows
  pip install -r requirements.txt
  ```
- **完成标准**: 所有依赖可正常安装，环境独立
- **预计耗时**: 10分钟

#### 任务1.3: 创建前端依赖文件
- **文件路径**: `tools/db-init-web/frontend/package.json`
- **任务描述**: 创建前端项目依赖配置 (统一技术栈)
- **技术栈统一**: 使用与现有系统一致的Naive UI组件库
- **核心依赖**:
  - vue@^3.3.8
  - vue-router@^4.2.5
  - pinia@^2.1.7
  - axios@^1.6.2
  - naive-ui@^2.38.1 (统一UI库)
  - @vicons/ionicons5@^0.12.0 (图标库)
- **开发依赖**:
  - vite@^5.0.0
  - @vitejs/plugin-vue@^4.5.0
  - unocss@^0.58.0 (统一样式方案)
- **完成标准**: 前端依赖可正常安装，技术栈统一
- **预计耗时**: 10分钟

### 🚀 阶段2: 后端API开发 (优先级: 高)

#### 任务2.1: 创建FastAPI主应用
- **文件路径**: `tools/db-init-web/app.py`
- **任务描述**: 创建FastAPI主应用文件
- **功能要求**:
  - 应用初始化
  - CORS中间件配置
  - 路由注册
  - 异常处理
- **API前缀**: `/api`
- **完成标准**: 应用可正常启动，端口8001
- **预计耗时**: 30分钟

#### 任务2.2: 实现数据库连接测试API
- **文件路径**: `tools/db-init-web/api/database.py`
- **任务描述**: 实现数据库连接测试功能
- **API端点**:
  - `POST /api/test-connection` - 测试连接
  - `GET /api/check-status` - 检查状态
- **支持数据库**: PostgreSQL, TDengine
- **完成标准**: 可正确测试两种数据库连接
- **预计耗时**: 45分钟

#### 任务2.3: 实现数据库初始化API
- **文件路径**: `tools/db-init-web/api/init.py`
- **任务描述**: 实现数据库初始化功能
- **API端点**:
  - `POST /api/init-database` - 初始化数据库
  - `GET /api/init-progress` - 获取进度
  - `POST /api/cancel-init` - 取消初始化
- **初始化步骤**: 5个步骤，支持进度跟踪
- **完成标准**: 可完整初始化数据库结构
- **预计耗时**: 60分钟

#### 任务2.4: 实现配置管理API
- **文件路径**: `tools/db-init-web/api/config.py`
- **任务描述**: 实现配置管理功能
- **API端点**:
  - `GET /api/config` - 获取配置
  - `POST /api/config` - 保存配置
  - `PUT /api/config` - 更新配置
- **配置加密**: 密码字段加密存储
- **完成标准**: 配置可正常读写
- **预计耗时**: 40分钟

#### 任务2.5: 实现日志与监控API
- **文件路径**: `tools/db-init-web/api/logs.py`
- **任务描述**: 实现日志管理功能
- **API端点**:
  - `GET /api/logs` - 获取日志列表
  - `GET /api/logs/{id}` - 获取详细日志
  - `DELETE /api/logs/{id}` - 删除日志
- **日志格式**: JSON格式，包含时间戳、级别、模块
- **完成标准**: 日志记录完整，查询正常
- **预计耗时**: 35分钟

### 🎨 阶段3: 前端界面开发 (优先级: 中)

#### 任务3.1: 创建前端项目结构
- **文件路径**: `tools/db-init-web/frontend/`
- **任务描述**: 创建Vue.js 3前端项目
- **技术栈**: Vue.js 3 + Naive UI + Axios (与现有系统统一)
- **创建文件**:
  - `package.json` - 前端依赖
  - `vite.config.js` - 构建配置
  - `src/main.js` - 应用入口
  - `src/App.vue` - 根组件
- **完成标准**: 前端项目可正常启动
- **预计耗时**: 25分钟

#### 任务3.2: 实现主界面框架
- **文件路径**: `tools/db-init-web/frontend/src/layouts/`
- **任务描述**: 创建主界面布局
- **界面元素**:
  - 顶部导航栏
  - 左侧菜单
  - 主内容区域
  - 状态栏
- **响应式设计**: 支持移动端适配
- **完成标准**: 界面美观，交互流畅
- **预计耗时**: 40分钟

#### 任务3.3: 实现连接测试页面
- **文件路径**: `tools/db-init-web/frontend/src/views/ConnectionTest.vue`
- **任务描述**: 创建数据库连接测试界面
- **功能元素**:
  - PostgreSQL配置表单
  - TDengine配置表单
  - 连接测试按钮
  - 测试结果展示
- **实时验证**: 表单验证和错误提示
- **完成标准**: 可正常测试数据库连接
- **预计耗时**: 45分钟

#### 任务3.4: 实现初始化向导页面
- **文件路径**: `tools/db-init-web/frontend/src/views/InitWizard.vue`
- **任务描述**: 创建数据库初始化向导
- **向导步骤**: 5步向导流程
- **功能元素**:
  - 步骤指示器
  - 进度条
  - 实时日志
  - 错误处理
- **完成标准**: 可完成完整初始化流程
- **预计耗时**: 60分钟

#### 任务3.5: 实现状态监控页面
- **文件路径**: `tools/db-init-web/frontend/src/views/StatusMonitor.vue`
- **任务描述**: 创建系统状态监控界面
- **监控内容**:
  - 数据库连接状态
  - 表结构检查
  - 数据完整性验证
  - 性能指标
- **实时更新**: 定时刷新状态
- **完成标准**: 状态展示准确，更新及时
- **预计耗时**: 35分钟

### 🔧 阶段4: 集成与部署 (优先级: 中)

#### 任务4.1: 创建启动脚本
- **文件路径**: `tools/db-init-web/start.py`
- **任务描述**: 创建应用启动脚本
- **功能要求**:
  - 环境检查
  - 依赖验证
  - 端口占用检查
  - 优雅启动
- **支持参数**: 端口、主机、调试模式
- **完成标准**: 一键启动，错误处理完善
- **预计耗时**: 25分钟

#### 任务4.2: 创建测试用例
- **文件路径**: `tools/db-init-web/tests/`
- **任务描述**: 创建完整的测试套件
- **测试类型**:
  - 单元测试（API测试）
  - 集成测试（数据库测试）
  - 端到端测试（界面测试）
- **测试覆盖率**: 80%以上
- **完成标准**: 所有测试通过
- **预计耗时**: 50分钟

#### 任务4.3: 创建部署文档
- **文件路径**: `tools/db-init-web/README.md`
- **任务描述**: 创建详细部署文档
- **文档内容**:
  - 环境要求
  - 安装步骤
  - 配置说明
  - 使用指南
  - 故障排除
- **完成标准**: 文档完整，步骤清晰
- **预计耗时**: 30分钟

---

## 📊 任务执行优先级

### 🔴 高优先级（必须完成）
1. 任务1.1 - 1.3：项目初始化
2. 任务2.1 - 2.3：核心API开发

### 🟡 中优先级（重要功能）
3. 任务2.4 - 2.5：辅助API
4. 任务3.1 - 3.5：前端界面
5. 任务4.1 - 4.3：集成部署

### 🟢 低优先级（优化改进）
- 界面美化
- 性能优化
- 额外功能

---

## ⏰ 时间估算

| 阶段 | 任务数 | 总耗时 | 实际进度 |
|------|--------|--------|----------|
| 阶段1 | 3 | 45分钟 | 待开始 |
| 阶段2 | 5 | 210分钟 | 待开始 |
| 阶段3 | 5 | 205分钟 | 待开始 |
| 阶段4 | 3 | 105分钟 | 待开始 |
| **总计** | **16** | **565分钟** | **约9.5小时** |

---

## ✅ 任务状态标记

使用以下标记跟踪任务进度：
- ⏳ 待开始
- 🔄 进行中
- ✅ 已完成
- ❌ 已阻塞
- ⚠️ 需验证

---

## 📋 检查清单

### 启动前检查
- [ ] 端口8001未被占用
- [ ] Python 3.8+ 已安装
- [ ] Node.js 16+ 已安装
- [ ] PostgreSQL服务运行正常
- [ ] TDengine服务运行正常

### 功能验证检查
- [ ] 数据库连接测试正常
- [ ] 初始化流程完整执行
- [ ] 前端界面响应正常
- [ ] 日志记录完整
- [ ] 错误处理完善

### 部署检查
- [ ] 启动脚本可执行
- [ ] 配置文件正确
- [ ] 测试用例全部通过
- [ ] 文档完整准确

---

## 🎯 下一步行动

1. **选择执行模式**: 根据需求选择阶段执行
2. **环境准备**: 确保开发环境就绪
3. **任务启动**: 从阶段1开始执行
4. **进度跟踪**: 使用任务状态标记更新进度
5. **质量验证**: 每个阶段完成后进行验证

**建议执行顺序**: 阶段1 → 阶段2 → 阶段4.1 → 阶段3 → 阶段4.2-4.3

---

*创建时间: 2025-01-19*
*最后更新: 2025-01-19*
*版本: 1.0*