# DeviceMonitorV2 è·¨ç«¯å¼€å‘æŒ‡å—

**ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-28  
**é€‚ç”¨å¹³å°**: Web (Vue3) + Mobile (NativeScript Vue3)

---

## ğŸ“– æ¦‚è¿°

æœ¬æŒ‡å—æ—¨åœ¨å¸®åŠ©å¼€å‘è€…ç†è§£å¹¶ä½¿ç”¨ DeviceMonitorV2 çš„è·¨ç«¯å¼€å‘æ¶æ„ï¼Œå®ç° Web ç«¯å’Œ Mobile ç«¯çš„ä»£ç å¤ç”¨ã€‚

### æ ¸å¿ƒç›®æ ‡

1. **ä»£ç å¤ç”¨**ï¼šæœ€å¤§åŒ–å¤ç”¨ä¸šåŠ¡é€»è¾‘ã€ç±»å‹å®šä¹‰å’Œå·¥å…·å‡½æ•°
2. **ç±»å‹å®‰å…¨**ï¼š100% TypeScript ç±»å‹è¦†ç›–ï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹
3. **å¼€å‘æ•ˆç‡**ï¼šä¸€æ¬¡ç¼–å†™ï¼ŒåŒç«¯å—ç›Šï¼Œå‡å°‘é‡å¤å·¥ä½œ
4. **ç»´æŠ¤æ€§**ï¼šç»Ÿä¸€ç®¡ç†ï¼Œä¿®å¤ä¸€å¤„å…¨ç«¯ç”Ÿæ•ˆ

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Web ç«¯ (Vue3)                    â”‚
â”‚         Mobile ç«¯ (NativeScript Vue3)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         é€‚é…å±‚ (Platform Adapter)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Shared å±‚ (Business Logic)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Shared å±‚ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰

**ä½ç½®**: `packages/shared/`

**èŒè´£**:
- å®šä¹‰è·¨ç«¯ç±»å‹
- å®ç°è·¨ç«¯å·¥å…·å‡½æ•°
- æä¾› HTTP å®¢æˆ·ç«¯
- å°è£…ä¸šåŠ¡ API

**ç‰¹ç‚¹**:
- âœ… æ—  UI ä¾èµ–
- âœ… æ— å¹³å°ç‰¹å®š API
- âœ… 100% TypeScript
- âœ… çº¯ä¸šåŠ¡é€»è¾‘

### é€‚é…å±‚ï¼ˆå¹³å°é€‚é…ï¼‰

**Web ç«¯ä½ç½®**:
- `web/src/types/shared.ts` - ç±»å‹é€‚é…
- `web/src/utils/index.js` - å·¥å…·é€‚é…
- `web/src/api/*-shared.js` - API é€‚é…

**Mobile ç«¯ä½ç½®**:
- `mobile/app/types/shared.ts` - ç±»å‹é€‚é…
- `mobile/app/services/api.ts` - API é€‚é…

**èŒè´£**:
- æä¾›ç»Ÿä¸€çš„å¯¼å…¥è·¯å¾„
- æ¡¥æ¥ Shared å±‚å’Œå¹³å°å±‚
- å¤„ç†å¹³å°ç‰¹å®šé€»è¾‘

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. Web ç«¯ä½¿ç”¨ Shared å±‚

#### å¯¼å…¥ç±»å‹

```typescript
// ä»é€‚é…å±‚å¯¼å…¥
import type { User, Device, Alarm } from '@/types/shared'

// æˆ–ç›´æ¥ä» Shared å±‚å¯¼å…¥
import type { User, Device, Alarm } from '@device-monitor/shared/types'

// ä½¿ç”¨ç±»å‹
const user: User = {
  id: 1,
  username: 'admin',
  email: 'admin@example.com',
  role: {
    id: 1,
    name: 'ç®¡ç†å‘˜'
  }
}
```

#### ä½¿ç”¨å·¥å…·å‡½æ•°

```typescript
// ä»é€‚é…å±‚å¯¼å…¥
import { formatDate, isEmpty, isValidEmail, debounce } from '@/utils'

// ä½¿ç”¨å·¥å…·å‡½æ•°
const formattedDate = formatDate(new Date(), 'YYYY-MM-DD')
if (isEmpty(userInput)) {
  console.log('è¾“å…¥ä¸ºç©º')
}

// é˜²æŠ–æœç´¢
const debouncedSearch = debounce((keyword) => {
  // æœç´¢é€»è¾‘
}, 300)
```

#### ä½¿ç”¨ API

```typescript
// ä» API é€‚é…å™¨å¯¼å…¥
import { deviceApi } from '@/api/device-shared'

// è°ƒç”¨ API
async function getDeviceList() {
  const { data } = await deviceApi.getList({
    page: 1,
    pageSize: 20,
    keyword: 'è®¾å¤‡åç§°'
  })
  return data
}
```

#### åœ¨ Vue ç»„ä»¶ä¸­ä½¿ç”¨

```vue
<template>
  <div>
    <h1>{{ formattedDate }}</h1>
    <div v-for="device in devices" :key="device.id">
      {{ device.name }}
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import type { Device } from '@/types/shared'
import { deviceApi } from '@/api/device-shared'
import { formatDate } from '@/utils'

// ç±»å‹å®‰å…¨çš„å“åº”å¼æ•°æ®
const devices = ref<Device[]>([])
const formattedDate = formatDate(new Date(), 'YYYY-MM-DD')

// è·å–è®¾å¤‡åˆ—è¡¨
onMounted(async () => {
  const { data } = await deviceApi.getList({ page: 1, pageSize: 10 })
  devices.value = data.items
})
</script>
```

---

### 2. Mobile ç«¯ä½¿ç”¨ Shared å±‚

#### å¯¼å…¥ç±»å‹

```typescript
// ä» Shared å±‚å¯¼å…¥
import type { User, Device, Alarm } from '@shared/types'

// ä½¿ç”¨ç±»å‹
const user: User = {
  id: 1,
  username: 'admin',
  email: 'admin@example.com'
}
```

#### ä½¿ç”¨å·¥å…·å‡½æ•°

```typescript
// ä» Shared å±‚å¯¼å…¥
import { formatDate, isEmpty, isValidEmail } from '@shared/utils'

// ä½¿ç”¨å®Œå…¨ç›¸åŒ
const formattedDate = formatDate(new Date(), 'YYYY-MM-DD')
```

#### ä½¿ç”¨ API

```typescript
// ä» Shared å±‚å¯¼å…¥
import { deviceApi } from '@shared/api'

// å®Œå…¨ç›¸åŒçš„ API è°ƒç”¨
async function getDeviceList() {
  const { data } = await deviceApi.getList({
    page: 1,
    pageSize: 20
  })
  return data
}
```

#### åœ¨ NativeScript Vue ç»„ä»¶ä¸­ä½¿ç”¨

```vue
<template>
  <Page>
    <ActionBar :title="pageTitle" />
    <StackLayout>
      <Label :text="formattedDate" />
      <ListView :items="devices">
        <template #default="{ item }">
          <Label :text="item.name" />
        </template>
      </ListView>
    </StackLayout>
  </Page>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'nativescript-vue'
import type { Device } from '@shared/types'
import { deviceApi } from '@shared/api'
import { formatDate } from '@shared/utils'

// ç±»å‹å®‰å…¨çš„å“åº”å¼æ•°æ®
const devices = ref<Device[]>([])
const pageTitle = 'è®¾å¤‡åˆ—è¡¨'
const formattedDate = formatDate(new Date(), 'YYYY-MM-DD')

// è·å–è®¾å¤‡åˆ—è¡¨
onMounted(async () => {
  const { data } = await deviceApi.getList({ page: 1, pageSize: 10 })
  devices.value = data.items
})
</script>
```

---

## ğŸ“¦ Shared å±‚è¯¦è§£

### ç±»å‹å®šä¹‰ (packages/shared/types)

#### é€šç”¨ç±»å‹ (common.ts)

```typescript
// å¯é€‰ç±»å‹
export type Maybe<T> = T | null | undefined

// ç»“æœç±»å‹
export type Result<T, E = Error> = 
  | { ok: true; data: T }
  | { ok: false; error: E }

// HTTP æ–¹æ³•
export type HttpMethod = 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH'
```

#### API å“åº”ç±»å‹ (api.ts)

```typescript
// æ ‡å‡† API å“åº”
export interface ApiResponse<T = any> {
  code: number
  data: T
  message?: string
  timestamp?: number
}

// åˆ†é¡µæ•°æ®
export interface Paginated<T> {
  items: T[]
  total: number
  page: number
  pageSize: number
  totalPages?: number
}

// åˆ†é¡µå‚æ•°
export interface PaginationParams {
  page?: number
  pageSize?: number
  keyword?: string
}
```

#### ä¸šåŠ¡å®ä½“ç±»å‹ (user.ts, device.ts, alarm.ts)

```typescript
// ç”¨æˆ·ç±»å‹
export interface User {
  id: number
  username: string
  nickname?: string
  email?: string
  phone?: string
  avatar?: string
  role?: Role
  department?: Department
  isActive?: boolean
  createdAt?: string
  updatedAt?: string
}

// è®¾å¤‡ç±»å‹
export interface Device {
  id: number
  code: string
  name: string
  type: DeviceType
  category: DeviceCategory
  status: DeviceStatus
  location?: string
  description?: string
  createdAt?: string
  updatedAt?: string
}

// å‘Šè­¦ç±»å‹
export interface Alarm {
  id: number
  deviceId: number
  device?: Device
  level: AlarmLevel
  type: string
  title: string
  content: string
  status: AlarmStatus
  occurredAt: string
  acknowledgedAt?: string
  resolvedAt?: string
}
```

### å·¥å…·å‡½æ•° (packages/shared/utils)

#### ç±»å‹æ£€æŸ¥ (validators.ts)

```typescript
// åŸºç¡€ç±»å‹æ£€æŸ¥
export const is = (val: unknown, type: string): boolean
export const isDef = <T = any>(val?: T): val is T
export const isUndef = <T = any>(val?: T): val is T | undefined
export const isObject = (val: any): val is Record<any, any>
export const isArray = (val: any): val is Array<any>
export const isEmpty = (val: unknown): boolean

// ä¸šåŠ¡éªŒè¯
export const isValidEmail = (email: string): boolean
export const isValidPhone = (phone: string): boolean
export const isUrl = (path: string): boolean
```

#### æ—¥æœŸæ—¶é—´ (datetime.ts)

```typescript
// æ—¥æœŸæ ¼å¼åŒ–
export const formatDate = (
  date: Date | string | number,
  format?: string
): string

export const formatDateTime = (
  date: Date | string | number
): string

// æ—¶é•¿æ ¼å¼åŒ–
export const formatDuration = (seconds: number): string

// ç›¸å¯¹æ—¶é—´
export const getRelativeTime = (date: Date | string | number): string
```

#### æ•°æ®æ ¼å¼åŒ– (format.ts)

```typescript
// æ–‡ä»¶å¤§å°
export const formatFileSize = (size: number): string

// æ•°å­—æ ¼å¼åŒ–
export const formatNumber = (
  num: number,
  decimals?: number
): string

// ç™¾åˆ†æ¯”
export const formatPercentage = (
  value: number,
  total: number,
  decimals?: number
): string

// è´§å¸
export const formatCurrency = (
  amount: number,
  currency?: string
): string

// éšç§é®ç½©
export const maskPhone = (phone: string): string
export const maskEmail = (email: string): string
```

#### è¾…åŠ©å‡½æ•° (helpers.ts)

```typescript
// é˜²æŠ–
export const debounce = <T extends (...args: any[]) => any>(
  func: T,
  wait: number
): (...args: Parameters<T>) => void

// èŠ‚æµ
export const throttle = <T extends (...args: any[]) => any>(
  func: T,
  wait: number
): (...args: Parameters<T>) => void

// æ·±å…‹éš†
export const deepClone = <T>(obj: T): T

// ç”Ÿæˆ ID
export const generateId = (): string

// æ•°ç»„å»é‡
export const unique = <T>(arr: T[]): T[]

// åˆ†ç»„
export const groupBy = <T>(
  arr: T[],
  key: keyof T
): Record<string, T[]>
```

### API å®¢æˆ·ç«¯ (packages/shared/api)

#### HTTP å®¢æˆ·ç«¯ (client.ts)

```typescript
export interface RequestConfig {
  url: string
  method?: HttpMethod
  params?: any
  data?: any
  headers?: Record<string, string>
  timeout?: number
}

export class HttpClient {
  constructor(config: {
    baseURL: string
    timeout?: number
    getToken?: () => string | null
  })

  async request<T>(config: RequestConfig): Promise<ApiResponse<T>>
  async get<T>(url: string, params?: any): Promise<ApiResponse<T>>
  async post<T>(url: string, data?: any): Promise<ApiResponse<T>>
  async put<T>(url: string, data?: any): Promise<ApiResponse<T>>
  async delete<T>(url: string, params?: any): Promise<ApiResponse<T>>
}
```

#### è®¤è¯ API (auth.ts)

```typescript
export interface AuthApi {
  login(credentials: LoginRequest): Promise<ApiResponse<LoginResponse>>
  logout(): Promise<ApiResponse<void>>
  getUserInfo(): Promise<ApiResponse<User>>
  refreshToken(): Promise<ApiResponse<{ token: string }>>
}
```

#### è®¾å¤‡ API (device.ts)

```typescript
export interface DeviceApi {
  getList(params: DeviceQueryParams): Promise<ApiResponse<Paginated<Device>>>
  getDetail(id: number): Promise<ApiResponse<Device>>
  create(data: DeviceCreateRequest): Promise<ApiResponse<Device>>
  update(id: number, data: DeviceUpdateRequest): Promise<ApiResponse<Device>>
  delete(id: number): Promise<ApiResponse<void>>
}
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç±»å‹å®šä¹‰ä¼˜å…ˆ

**âœ… æ¨è**:
```typescript
// 1. å…ˆå®šä¹‰ç±»å‹
interface DeviceFormData {
  code: string
  name: string
  typeId: number
}

// 2. ä½¿ç”¨ç±»å‹
const formData = ref<DeviceFormData>({
  code: '',
  name: '',
  typeId: 0
})
```

**âŒ é¿å…**:
```typescript
// æ²¡æœ‰ç±»å‹å®šä¹‰
const formData = ref({
  code: '',
  name: '',
  typeId: 0
})
```

### 2. ä½¿ç”¨ Shared å±‚ç±»å‹

**âœ… æ¨è**:
```typescript
import type { Device } from '@/types/shared'

const devices = ref<Device[]>([])
```

**âŒ é¿å…**:
```typescript
// è‡ªå®šä¹‰ç±»å‹ï¼Œç ´åè·¨ç«¯ä¸€è‡´æ€§
interface MyDevice {
  id: number
  name: string
}
```

### 3. ç»Ÿä¸€ä½¿ç”¨ Shared API

**âœ… æ¨è**:
```typescript
import { deviceApi } from '@/api/device-shared'

const { data } = await deviceApi.getList({ page: 1 })
```

**âŒ é¿å…**:
```typescript
// ç›´æ¥ä½¿ç”¨ axiosï¼Œç»•è¿‡ Shared å±‚
import axios from 'axios'
const { data } = await axios.get('/api/devices')
```

### 4. ä½¿ç”¨ Shared å·¥å…·å‡½æ•°

**âœ… æ¨è**:
```typescript
import { formatDate, isEmpty } from '@/utils'

const date = formatDate(new Date(), 'YYYY-MM-DD')
```

**âŒ é¿å…**:
```typescript
// è‡ªå·±å®ç°ï¼Œé‡å¤é€ è½®å­
function formatDate(date: Date) {
  // ...
}
```

### 5. é¿å…å¹³å°ç‰¹å®š API

**âœ… æ¨èï¼ˆShared å±‚ï¼‰**:
```typescript
// å®šä¹‰æŠ½è±¡æ¥å£
export interface Storage {
  getItem(key: string): string | null
  setItem(key: string, value: string): void
  removeItem(key: string): void
}

// å„ç«¯å®ç°
// Web: ä½¿ç”¨ localStorage
// Mobile: ä½¿ç”¨ ApplicationSettings
```

**âŒ é¿å…ï¼ˆShared å±‚ï¼‰**:
```typescript
// ç›´æ¥ä½¿ç”¨æµè§ˆå™¨ API
function saveToken(token: string) {
  localStorage.setItem('token', token) // âŒ æ— æ³•åœ¨ Mobile ç«¯ä½¿ç”¨
}
```

---

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### æ·»åŠ æ–°åŠŸèƒ½

#### 1. å®šä¹‰ç±»å‹ï¼ˆShared å±‚ï¼‰

```typescript
// packages/shared/types/repair.ts
export interface RepairRecord {
  id: number
  deviceId: number
  device?: Device
  type: RepairType
  description: string
  status: RepairStatus
  startedAt: string
  completedAt?: string
}

export enum RepairStatus {
  Pending = 'pending',
  InProgress = 'in_progress',
  Completed = 'completed',
  Cancelled = 'cancelled'
}
```

#### 2. å®ç° APIï¼ˆShared å±‚ï¼‰

```typescript
// packages/shared/api/repair.ts
import { HttpClient } from './client'
import type { ApiResponse, Paginated } from '../types'
import type { RepairRecord } from '../types/repair'

export interface RepairApi {
  getList(params?: any): Promise<ApiResponse<Paginated<RepairRecord>>>
  getDetail(id: number): Promise<ApiResponse<RepairRecord>>
  create(data: any): Promise<ApiResponse<RepairRecord>>
  update(id: number, data: any): Promise<ApiResponse<RepairRecord>>
}

export function createRepairApi(client: HttpClient): RepairApi {
  return {
    async getList(params) {
      return client.get<Paginated<RepairRecord>>('/repairs', params)
    },
    async getDetail(id) {
      return client.get<RepairRecord>(`/repairs/${id}`)
    },
    async create(data) {
      return client.post<RepairRecord>('/repairs', data)
    },
    async update(id, data) {
      return client.put<RepairRecord>(`/repairs/${id}`, data)
    }
  }
}
```

#### 3. å¯¼å‡ºï¼ˆShared å±‚ï¼‰

```typescript
// packages/shared/types/index.ts
export * from './repair'

// packages/shared/api/index.ts
export * from './repair'
```

#### 4. åˆ›å»ºé€‚é…å™¨ï¼ˆWeb ç«¯ï¼‰

```typescript
// web/src/api/repair-shared.js
import { repairApi as sharedRepairApi } from '@device-monitor/shared/api'

// ç›´æ¥å¯¼å‡º
export const repairApi = sharedRepairApi

// æˆ–æ·»åŠ  Web ç«¯ç‰¹æœ‰æ–¹æ³•
export const repairApi = {
  ...sharedRepairApi,
  exportExcel(params) {
    // Web ç«¯ç‰¹æœ‰çš„å¯¼å‡ºåŠŸèƒ½
  }
}
```

#### 5. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼ˆWeb ç«¯ï¼‰

```vue
<script setup lang="ts">
import type { RepairRecord } from '@/types/shared'
import { repairApi } from '@/api/repair-shared'

const repairs = ref<RepairRecord[]>([])

async function fetchRepairs() {
  const { data } = await repairApi.getList({ page: 1, pageSize: 20 })
  repairs.value = data.items
}
</script>
```

#### 6. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼ˆMobile ç«¯ï¼‰

```vue
<script setup lang="ts">
import type { RepairRecord } from '@shared/types'
import { repairApi } from '@shared/api'

const repairs = ref<RepairRecord[]>([])

async function fetchRepairs() {
  const { data } = await repairApi.getList({ page: 1, pageSize: 20 })
  repairs.value = data.items
}
</script>
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä»€ä¹ˆå¯ä»¥æ”¾åœ¨ Shared å±‚ï¼Ÿ

**å¯ä»¥æ”¾å…¥**:
- âœ… ç±»å‹å®šä¹‰
- âœ… çº¯å‡½æ•°ï¼ˆæ— å‰¯ä½œç”¨ï¼‰
- âœ… HTTP å®¢æˆ·ç«¯
- âœ… API è°ƒç”¨é€»è¾‘
- âœ… æ•°æ®éªŒè¯é€»è¾‘
- âœ… ä¸šåŠ¡è§„åˆ™

**ä¸å¯ä»¥æ”¾å…¥**:
- âŒ UI ç»„ä»¶ï¼ˆVue/NativeScript ç»„ä»¶ï¼‰
- âŒ æµè§ˆå™¨ APIï¼ˆwindow, document, localStorageï¼‰
- âŒ Node.js APIï¼ˆfs, pathï¼‰
- âŒ å¹³å°ç‰¹å®šä»£ç 

### Q2: å¦‚ä½•å¤„ç†å¹³å°å·®å¼‚ï¼Ÿ

ä½¿ç”¨**æŠ½è±¡æ¥å£ + å„ç«¯å®ç°**ï¼š

```typescript
// Shared å±‚ï¼šå®šä¹‰æ¥å£
export interface Storage {
  getItem(key: string): string | null
  setItem(key: string, value: string): void
}

// Web ç«¯ï¼šå®ç°
class WebStorage implements Storage {
  getItem(key: string) {
    return localStorage.getItem(key)
  }
  setItem(key: string, value: string) {
    localStorage.setItem(key, value)
  }
}

// Mobile ç«¯ï¼šå®ç°
import * as ApplicationSettings from '@nativescript/core/application-settings'

class MobileStorage implements Storage {
  getItem(key: string) {
    return ApplicationSettings.getString(key, null)
  }
  setItem(key: string, value: string) {
    ApplicationSettings.setString(key, value)
  }
}
```

### Q3: å¦‚ä½•è°ƒè¯• Shared å±‚ä»£ç ï¼Ÿ

**Web ç«¯**:
```typescript
// åœ¨æµè§ˆå™¨å¼€å‘å·¥å…·ä¸­è°ƒè¯•
import { deviceApi } from '@/api/device-shared'

console.log('Calling deviceApi.getList')
const result = await deviceApi.getList({ page: 1 })
console.log('Result:', result)
```

**Mobile ç«¯**:
```typescript
// ä½¿ç”¨ NativeScript è°ƒè¯•å·¥å…·
import { deviceApi } from '@shared/api'

console.log('Calling deviceApi.getList')
const result = await deviceApi.getList({ page: 1 })
console.log('Result:', result)
```

### Q4: Shared å±‚ç±»å‹ä¸åŒ¹é…æ€ä¹ˆåŠï¼Ÿ

**æ£€æŸ¥ç±»å‹å®šä¹‰**:
```typescript
// 1. æŸ¥çœ‹ Shared å±‚ç±»å‹å®šä¹‰
import type { Device } from '@/types/shared'

// 2. ä½¿ç”¨ç±»å‹æ–­è¨€ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
const device = apiResponse.data as Device

// 3. ä½¿ç”¨ç±»å‹å®ˆå«
function isDevice(obj: any): obj is Device {
  return obj && typeof obj.id === 'number' && typeof obj.name === 'string'
}
```

---

## ğŸ“š è¿›é˜¶ä¸»é¢˜

### 1. æ‰©å±• Shared API

```typescript
// Web ç«¯æ‰©å±•
import { deviceApi as sharedDeviceApi } from '@device-monitor/shared/api'

export const deviceApi = {
  ...sharedDeviceApi,
  
  // Web ç«¯ç‰¹æœ‰ï¼šå¯¼å‡º Excel
  async exportExcel(params: any) {
    const blob = await axios.get('/devices/export', {
      params,
      responseType: 'blob'
    })
    // ä¸‹è½½æ–‡ä»¶
  },
  
  // Web ç«¯ç‰¹æœ‰ï¼šæ‰¹é‡æ“ä½œ
  async batchDelete(ids: number[]) {
    return axios.post('/devices/batch-delete', { ids })
  }
}
```

### 2. è‡ªå®šä¹‰ HTTP æ‹¦æˆªå™¨

```typescript
// Web ç«¯
import { createHttpClient } from '@device-monitor/shared/api'

const client = createHttpClient({
  baseURL: '/api/v2',
  getToken: () => localStorage.getItem('token'),
  
  // è¯·æ±‚æ‹¦æˆªå™¨
  requestInterceptor: (config) => {
    console.log('Request:', config)
    return config
  },
  
  // å“åº”æ‹¦æˆªå™¨
  responseInterceptor: (response) => {
    console.log('Response:', response)
    return response
  },
  
  // é”™è¯¯å¤„ç†
  errorHandler: (error) => {
    console.error('API Error:', error)
    throw error
  }
})
```

### 3. Pinia Store ä½¿ç”¨ Shared ç±»å‹

```typescript
// stores/device.ts
import { defineStore } from 'pinia'
import type { Device, Paginated } from '@/types/shared'
import { deviceApi } from '@/api/device-shared'

interface DeviceState {
  devices: Device[]
  total: number
  loading: boolean
}

export const useDeviceStore = defineStore('device', {
  state: (): DeviceState => ({
    devices: [],
    total: 0,
    loading: false
  }),
  
  actions: {
    async fetchDevices(params: any) {
      this.loading = true
      try {
        const { data } = await deviceApi.getList(params)
        this.devices = data.items
        this.total = data.total
      } finally {
        this.loading = false
      }
    }
  }
})
```

---

## ğŸ“– å‚è€ƒèµ„æ–™

### ç›¸å…³æ–‡æ¡£

- ğŸ“ [Shared å±‚è¿ç§»è¿›åº¦](./Webç«¯Sharedå±‚è¿ç§»è¿›åº¦.md)
- ğŸ“Š [Shared å±‚è¿ç§»æœ€ç»ˆæ€»ç»“](./Sharedå±‚è¿ç§»æœ€ç»ˆæ€»ç»“-2025-10-28.md)
- ğŸª [Pinia Store è¿ç§»æ€»ç»“](./Storeè¿ç§»å®Œæˆæ€»ç»“-2025-10-28.md)
- ğŸ§¹ [æ—§æ–‡ä»¶æ¸…ç†æ€»ç»“](./æ—§æ–‡ä»¶æ¸…ç†å®Œæˆæ€»ç»“-2025-10-28.md)
- ğŸ“š [Shared å±‚ README](../packages/shared/README.md)

### å¤–éƒ¨èµ„æº

- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/)
- [Vue 3 æ–‡æ¡£](https://vuejs.org/)
- [NativeScript Vue æ–‡æ¡£](https://nativescript-vue.org/)
- [Pinia æ–‡æ¡£](https://pinia.vuejs.org/)

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°çš„ Shared åŠŸèƒ½

1. åœ¨ `packages/shared/` ä¸­æ·»åŠ ä»£ç 
2. ç¡®ä¿æ— å¹³å°ç‰¹å®šä¾èµ–
3. æ·»åŠ å®Œæ•´çš„ TypeScript ç±»å‹
4. åœ¨ Web å’Œ Mobile ç«¯æµ‹è¯•
5. æ›´æ–°ç›¸å…³æ–‡æ¡£

### ä»£ç å®¡æŸ¥è¦ç‚¹

- [ ] ç±»å‹å®šä¹‰å®Œæ•´
- [ ] æ— å¹³å°ç‰¹å®š API
- [ ] å‡½æ•°çº¯ç²¹ï¼ˆæ— å‰¯ä½œç”¨ï¼‰
- [ ] æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†
- [ ] åœ¨åŒç«¯æµ‹è¯•é€šè¿‡

---

**æœ€åæ›´æ–°**: 2025-10-28  
**ç»´æŠ¤è€…**: DeviceMonitorV2 å¼€å‘å›¢é˜Ÿ


