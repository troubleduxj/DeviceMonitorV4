# æ‰¹é‡ç»„ä»¶è¿ç§»æŒ‡å—

> åŸºäºæˆåŠŸçš„è®¾å¤‡åˆ—è¡¨è¿ç§»ç»éªŒï¼Œå¿«é€Ÿæ‰¹é‡è¿ç§»ç»„ä»¶åˆ° Shared API å±‚

## ğŸ¯ è¿ç§»ç›®æ ‡

åŸºäºé¦–ä¸ªæˆåŠŸæ¡ˆä¾‹ï¼Œæ‰¹é‡è¿ç§»ä»¥ä¸‹ç»„ä»¶ï¼š

| åºå· | ç»„ä»¶ | è·¯å¾„ | ä¸»è¦ API | éš¾åº¦ | çŠ¶æ€ |
|------|------|------|---------|------|------|
| 1 | è®¾å¤‡åˆ—è¡¨ | `views/device/baseinfo/index.vue` | deviceApi | â­â­ | âœ… å·²å®Œæˆ |
| 2 | è®¾å¤‡ç±»å‹ | `views/device/type/index.vue` | deviceTypeApi | â­ | â³ è¿›è¡Œä¸­ |
| 3 | å‘Šè­¦åˆ—è¡¨ | `views/alarm/alarm-info/index.vue` | alarmApi | â­â­ | â³ è¿›è¡Œä¸­ |
| 4 | ç»´ä¿®è®°å½• | `views/device-maintenance/repair-records/index.vue` | repairApi | â­â­ | â³ å¾…å¼€å§‹ |

---

## ğŸš€ å¿«é€Ÿè¿ç§»æ¨¡æ¿

### æ­¥éª¤ 1ï¼šè¯†åˆ« API è°ƒç”¨

ä½¿ç”¨ grep æŸ¥æ‰¾å½“å‰é¡µé¢ä½¿ç”¨çš„ APIï¼š

```bash
grep -n "import.*api" your-component.vue
grep -n "Api\." your-component.vue
```

### æ­¥éª¤ 2ï¼šåˆ›å»ºè¿ç§»æ¸…å•

| æ—§ API | æ–° API | æ”¹åŠ¨ä½ç½® |
|--------|--------|----------|
| `import deviceV2Api` | `import { deviceApi }` | ç¬¬ X è¡Œ |
| `deviceV2Api.list()` | `deviceApi.list()` | ç¬¬ Y è¡Œ |

### æ­¥éª¤ 3ï¼šæ‰§è¡Œæ›¿æ¢

ä½¿ç”¨ VS Code çš„æŸ¥æ‰¾æ›¿æ¢åŠŸèƒ½ï¼ˆCtrl+Hï¼‰ï¼š

1. **æ›¿æ¢å¯¼å…¥è¯­å¥**
   ```
   æŸ¥æ‰¾: import deviceV2Api from '@/api/device-v2'
   æ›¿æ¢: import { deviceApi } from '@/api/device-shared'
   ```

2. **æ›¿æ¢ API è°ƒç”¨**
   ```
   æŸ¥æ‰¾: deviceV2Api\.
   æ›¿æ¢: deviceApi.
   ```

3. **æ·»åŠ æ—¥å¿—æ ‡è®°**
   ```javascript
   // åœ¨ API è°ƒç”¨åæ·»åŠ 
   console.log('âœ… Shared API å“åº”:', response)
   ```

### æ­¥éª¤ 4ï¼šéªŒè¯åŠŸèƒ½

1. ä¿å­˜æ–‡ä»¶
2. åˆ·æ–°æµè§ˆå™¨
3. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
4. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—

---

## ğŸ“ æ ‡å‡†è¿ç§»æ¨¡æ¿

### æ¨¡æ¿ 1ï¼šåˆ—è¡¨é¡µé¢

```vue
<script setup>
// ========== å¯¼å…¥æ”¹åŠ¨ ==========
// æ—§ï¼šimport deviceV2Api from '@/api/device-v2'
// æ–°ï¼šimport { deviceApi } from '@/api/device-shared'
import { deviceApi } from '@/api/device-shared'

// ========== API è°ƒç”¨æ”¹åŠ¨ ==========
async function loadList() {
  try {
    // æ—§ï¼šconst result = await deviceV2Api.list(params)
    // æ–°ï¼šconst result = await deviceApi.list(params)
    const result = await deviceApi.list(params)
    console.log('âœ… Shared API å“åº”:', result)
    
    // æ•°æ®å¤„ç†é€»è¾‘ä¿æŒä¸å˜
    tableData.value = result.data.items || []
  } catch (error) {
    console.error('âŒ åŠ è½½å¤±è´¥:', error)
  }
}
</script>
```

### æ¨¡æ¿ 2ï¼šè¡¨å•é¡µé¢ï¼ˆåˆ›å»º/ç¼–è¾‘ï¼‰

```vue
<script setup>
import { deviceApi } from '@/api/device-shared'

async function handleSave() {
  try {
    if (isEdit.value) {
      // æ—§ï¼šawait deviceV2Api.update(id, data)
      // æ–°ï¼šawait deviceApi.update(id, data)
      await deviceApi.update(formData.value.id, formData.value)
    } else {
      // æ—§ï¼šawait deviceV2Api.create(data)
      // æ–°ï¼šawait deviceApi.create(data)
      await deviceApi.create(formData.value)
    }
    window.$message?.success('ä¿å­˜æˆåŠŸ')
  } catch (error) {
    window.$message?.error(`ä¿å­˜å¤±è´¥: ${error.message}`)
  }
}
</script>
```

### æ¨¡æ¿ 3ï¼šè¯¦æƒ…é¡µé¢

```vue
<script setup>
import { deviceApi } from '@/api/device-shared'
import { useRoute } from 'vue-router'

const route = useRoute()
const detail = ref({})

async function loadDetail() {
  try {
    // æ—§ï¼šconst result = await deviceV2Api.get(id)
    // æ–°ï¼šconst result = await deviceApi.get(id)
    const result = await deviceApi.get(route.params.id)
    detail.value = result.data
  } catch (error) {
    window.$message?.error('åŠ è½½å¤±è´¥')
  }
}

onMounted(() => {
  loadDetail()
})
</script>
```

---

## ğŸ”§ API æ˜ å°„é€ŸæŸ¥è¡¨

### è®¾å¤‡ç›¸å…³

| æ—§ API | æ–° API | è¯´æ˜ |
|--------|--------|------|
| `deviceV2Api.list()` | `deviceApi.list()` | è·å–è®¾å¤‡åˆ—è¡¨ |
| `deviceV2Api.get(id)` | `deviceApi.get(id)` | è·å–è®¾å¤‡è¯¦æƒ… |
| `deviceV2Api.create(data)` | `deviceApi.create(data)` | åˆ›å»ºè®¾å¤‡ |
| `deviceV2Api.update(id, data)` | `deviceApi.update(id, data)` | æ›´æ–°è®¾å¤‡ |
| `deviceV2Api.delete(id)` | `deviceApi.delete(id)` | åˆ é™¤è®¾å¤‡ |
| `deviceV2Api.batchDelete(ids)` | `deviceApi.batchDelete(ids)` | æ‰¹é‡åˆ é™¤ |

### å‘Šè­¦ç›¸å…³

| æ—§ API | æ–° API | è¯´æ˜ |
|--------|--------|------|
| `alarmApi.list()` | `alarmApi.list()` | è·å–å‘Šè­¦åˆ—è¡¨ï¼ˆä» alarm-shared å¯¼å…¥ï¼‰ |
| `alarmApi.getStats()` | `alarmApi.getStats()` | è·å–å‘Šè­¦ç»Ÿè®¡ |
| `alarmApi.acknowledge(id)` | `alarmApi.acknowledge(id)` | ç¡®è®¤å‘Šè­¦ |
| `alarmApi.resolve(id)` | `alarmApi.resolve(id)` | è§£å†³å‘Šè­¦ |

### ç»´ä¿®ç›¸å…³

| æ—§ API | æ–° API | è¯´æ˜ |
|--------|--------|------|
| `repairApi.list()` | `repairApi.list()` | è·å–ç»´ä¿®åˆ—è¡¨ï¼ˆä» repair-shared å¯¼å…¥ï¼‰ |
| `repairApi.create(data)` | `repairApi.create(data)` | åˆ›å»ºç»´ä¿®è®°å½• |
| `repairApi.complete(id)` | `repairApi.complete(id)` | å®Œæˆç»´ä¿® |

---

## âš¡ å¿«é€Ÿè¿ç§»å‘½ä»¤

### 1. æŸ¥æ‰¾éœ€è¦è¿ç§»çš„æ–‡ä»¶

```bash
# æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨æ—§ API çš„æ–‡ä»¶
grep -r "deviceV2Api" web/src/views --include="*.vue"
grep -r "from '@/api/device-v2'" web/src/views --include="*.vue"
```

### 2. æ‰¹é‡æ›¿æ¢ï¼ˆæ…ç”¨ï¼‰

```bash
# ä½¿ç”¨ sed æ‰¹é‡æ›¿æ¢ï¼ˆLinux/Macï¼‰
find web/src/views -name "*.vue" -exec sed -i 's/deviceV2Api/deviceApi/g' {} \;
find web/src/views -name "*.vue" -exec sed -i "s|from '@/api/device-v2'|from '@/api/device-shared'|g" {} \;

# Windows PowerShell
Get-ChildItem -Path "web\src\views" -Filter "*.vue" -Recurse | ForEach-Object {
  (Get-Content $_.FullName) -replace 'deviceV2Api', 'deviceApi' | Set-Content $_.FullName
}
```

âš ï¸ **æ³¨æ„**ï¼šæ‰¹é‡æ›¿æ¢å‰è¯·å…ˆå¤‡ä»½æ–‡ä»¶ï¼

---

## âœ… è¿ç§»æ£€æŸ¥æ¸…å•

### æ¯ä¸ªç»„ä»¶è¿ç§»åæ£€æŸ¥

- [ ] å¯¼å…¥è¯­å¥å·²æ›´æ–°ï¼ˆä½¿ç”¨ `*-shared.js`ï¼‰
- [ ] æ‰€æœ‰ API è°ƒç”¨å·²æ›¿æ¢
- [ ] æ·»åŠ äº†è°ƒè¯•æ—¥å¿—ï¼ˆâœ… æ ‡è®°ï¼‰
- [ ] é¡µé¢å¯ä»¥æ­£å¸¸åŠ è½½
- [ ] åˆ—è¡¨æ•°æ®æ­£å¸¸æ˜¾ç¤º
- [ ] åˆ›å»ºåŠŸèƒ½æ­£å¸¸
- [ ] ç¼–è¾‘åŠŸèƒ½æ­£å¸¸
- [ ] åˆ é™¤åŠŸèƒ½æ­£å¸¸
- [ ] æœç´¢/è¿‡æ»¤åŠŸèƒ½æ­£å¸¸
- [ ] åˆ†é¡µåŠŸèƒ½æ­£å¸¸
- [ ] æ— æ§åˆ¶å°é”™è¯¯

### å…¨å±€æ£€æŸ¥

- [ ] æ‰€æœ‰ç›®æ ‡ç»„ä»¶å·²è¿ç§»
- [ ] è¿è¡Œ `npm run build` æ— é”™è¯¯
- [ ] è¿è¡Œ `npm run lint` æ— é”™è¯¯
- [ ] å·²æäº¤åˆ° Git
- [ ] å·²æ¨é€åˆ°è¿œç¨‹ä»“åº“
- [ ] æ›´æ–°è¿ç§»è¿›åº¦æ–‡æ¡£

---

## ğŸ“Š è¿ç§»è¿›åº¦è¿½è¸ª

### å½“å‰è¿›åº¦

```
å·²è¿ç§»: 1 / 10
è¿›åº¦: â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 10%
```

### è¯¦ç»†åˆ—è¡¨

| æ¨¡å— | é¡µé¢ | çŠ¶æ€ | è¿ç§»äºº | å®Œæˆæ—¶é—´ |
|------|------|------|--------|----------|
| è®¾å¤‡ç®¡ç† | è®¾å¤‡åˆ—è¡¨ | âœ… | AI | 2025-10-25 |
| è®¾å¤‡ç®¡ç† | è®¾å¤‡ç±»å‹ | â³ | - | - |
| è®¾å¤‡ç®¡ç† | è®¾å¤‡è¯¦æƒ… | â³ | - | - |
| å‘Šè­¦ç®¡ç† | å‘Šè­¦åˆ—è¡¨ | â³ | - | - |
| å‘Šè­¦ç®¡ç† | å‘Šè­¦ç»Ÿè®¡ | â³ | - | - |
| ç»´ä¿®ç®¡ç† | ç»´ä¿®åˆ—è¡¨ | â³ | - | - |
| ç»´ä¿®ç®¡ç† | ç»´ä¿®è¯¦æƒ… | â³ | - | - |
| ç”¨æˆ·ç®¡ç† | ç”¨æˆ·åˆ—è¡¨ | â³ | - | - |
| è§’è‰²ç®¡ç† | è§’è‰²åˆ—è¡¨ | â³ | - | - |
| ç³»ç»Ÿé…ç½® | é…ç½®ç®¡ç† | â³ | - | - |

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ¸è¿›å¼è¿ç§»

- âœ… ä¸€æ¬¡è¿ç§»ä¸€ä¸ªé¡µé¢
- âœ… è¿ç§»åç«‹å³æµ‹è¯•
- âœ… ç¡®è®¤æ— è¯¯åå†è¿ç§»ä¸‹ä¸€ä¸ª

### 2. ä¿ç•™å¤‡ä»½

```bash
# è¿ç§»å‰å¤‡ä»½
cp original.vue original.vue.bak

# è¿ç§»åéªŒè¯
diff original.vue.bak original.vue

# ç¡®è®¤æ— è¯¯ååˆ é™¤å¤‡ä»½
rm original.vue.bak
```

### 3. æ·»åŠ æ ‡è®°

```vue
<template>
  <CommonPage>
    <!-- é¡µé¢å†…å®¹ -->
    
    <!-- è¿ç§»æ ‡è®° -->
    <div class="migration-badge">
      <n-tag type="success" size="small">
        âœ… å·²è¿ç§» (2025-10-25)
      </n-tag>
    </div>
  </CommonPage>
</template>
```

### 4. æäº¤è§„èŒƒ

```bash
# å•ä¸ªç»„ä»¶è¿ç§»
git commit -m "feat(views): è¿ç§»è®¾å¤‡ç±»å‹é¡µé¢åˆ° Shared API"

# æ‰¹é‡è¿ç§»
git commit -m "feat(views): æ‰¹é‡è¿ç§»è®¾å¤‡æ¨¡å—åˆ° Shared API (3ä¸ªé¡µé¢)"
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šAPI å“åº”æ ¼å¼ä¸ä¸€è‡´

**ç—‡çŠ¶**: æ•°æ®æ— æ³•æ­£ç¡®æ˜¾ç¤º

**è§£å†³**: æ£€æŸ¥ `*-shared.js` ä¸­çš„å“åº”åŒ…è£…
```javascript
// device-shared.js å·²åšç»Ÿä¸€åŒ…è£…
return { data: result.data };
```

### é—®é¢˜ 2ï¼šç±»å‹é”™è¯¯

**ç—‡çŠ¶**: TypeScript æŠ¥é”™

**è§£å†³**: å¯¼å…¥ Shared ç±»å‹
```typescript
import type { Device } from '@/types/shared';
```

### é—®é¢˜ 3ï¼šè·¯å¾„åˆ«åé”™è¯¯

**ç—‡çŠ¶**: `Cannot resolve '@shared/*'`

**è§£å†³**: æ£€æŸ¥ `vite.config.js`
```javascript
alias: {
  '@shared': getRootPath() + '/../packages/shared',
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç»„ä»¶è¿ç§»ç¤ºä¾‹ - è®¾å¤‡åˆ—è¡¨](./ç»„ä»¶è¿ç§»ç¤ºä¾‹-è®¾å¤‡åˆ—è¡¨.md)
- [Shared å±‚ API å¿«é€Ÿå‚è€ƒ](./Sharedå±‚APIå¿«é€Ÿå‚è€ƒ.md)
- [Web ç«¯æ¥å…¥ Shared å±‚æŒ‡å—](./Webç«¯æ¥å…¥Sharedå±‚æŒ‡å—.md)
- [Web ç«¯ Shared å±‚è¿ç§»è¿›åº¦](./Webç«¯Sharedå±‚è¿ç§»è¿›åº¦.md)

---

## ğŸ‰ è¿ç§»å®Œæˆå

1. è¿è¡Œå®Œæ•´æµ‹è¯•
2. æ›´æ–°æ–‡æ¡£
3. æäº¤ä»£ç 
4. é€šçŸ¥å›¢é˜Ÿ
5. å‡†å¤‡ä¸‹ä¸€æ‰¹è¿ç§»

**ç›®æ ‡**ï¼šæ¯å¤©è¿ç§» 2-3 ä¸ªç»„ä»¶ï¼Œä¸€å‘¨å†…å®Œæˆæ ¸å¿ƒæ¨¡å—ï¼

