# AI监测页面Mock数据问题总结

> **发现时间**: 2025-11-05 19:15  
> **严重程度**: ⚠️ 中等（影响数据真实性）  
> **用户发现**: ✅ 正确  

---

## ❌ 问题确认

### 用户观察：完全正确！ ✅

**用户发现**：即使没有启用Mock数据管理系统，AI监测模块各页面仍然显示大量模拟数据。

**核查结果**：✅ **用户说得对！**

---

## 🔍 问题根源

### AI监测页面存在两套Mock数据机制

#### ❌ 机制1：页面硬编码Mock数据（实际使用的）

**位置**：直接写在Vue组件的`<script>`中

**示例**：
```javascript
// web/src/views/ai-monitor/trend-prediction/index.vue

const riskData = ref([
  {
    deviceId: 'WLD-001',
    deviceName: '焊接设备01',
    riskLevel: 'high',
    failureProbability: 85.2,
    // ... 硬编码的Mock数据
  },
  {
    deviceId: 'WLD-002',
    // ... 更多硬编码数据
  }
])
```

**特点**：
- ❌ 直接写在代码中
- ❌ 不受Mock管理系统控制
- ❌ 无法通过页面启用/禁用
- ❌ **永远显示**，即使没有启用Mock

---

#### ✅ 机制2：Mock数据管理系统（我刚添加的）

**位置**：数据库 `t_sys_mock_data` 表

**工作方式**：
- ✅ 拦截API请求
- ✅ 返回配置的Mock数据
- ✅ 可以启用/禁用
- ✅ 可以在页面管理

**但是**：
- ⚠️ 只有当页面**调用API**时才生效
- ⚠️ 如果页面使用硬编码数据，这套系统**不起作用**

---

## 📋 硬编码Mock数据清单

### 发现的硬编码数据

**趋势预测页面** (`trend-prediction/index.vue`):
1. Line 301-309: `healthTrendData` - 7条健康趋势记录
2. Line 312-364: `riskData` - 3个设备风险评估
3. Line 380-394: `reportData` - 预测报告数据
4. Line 286-289: 统计数据（predictionAccuracy, predictedDevices等）

**健康评分页面** (`health-scoring/index.vue`):
1. Line 259-298+: `deviceList` - 多个设备健康数据
2. Line 243-249: `scoreDistributionData` - 评分分布
3. Line 219-224: `overviewStats` - 统计概览

**异常检测页面** (`anomaly-detection/index.vue`):
- 需要检查是否也有硬编码数据

**Dashboard页面** (`dashboard/index.vue`):
- 需要检查概览数据

---

## 🎯 为什么会这样？

### 历史原因

1. **开发阶段**：为了快速开发UI，先用硬编码数据
2. **演示需求**：需要有数据展示页面效果
3. **后端未完成**：当时后端API可能还没开发

### 忘记清理

- ❌ 后端API开发完成后，忘记替换硬编码数据
- ❌ 即使添加了真实API调用（refreshPrediction），但页面初始显示的仍是硬编码数据
- ❌ Mock数据管理系统和页面硬编码数据没有关联

---

## 💡 解决方案

### 方案A：完全清理硬编码数据（推荐）⭐

**目标**：让页面完全依赖API数据

**步骤**：
1. ✅ 删除所有硬编码的Mock数据
2. ✅ 改为空数组/空对象初始化
3. ✅ 在页面加载时调用API获取数据
4. ✅ 显示加载状态
5. ✅ 处理加载失败情况

**效果**：
- ✅ 启用Mock管理系统 → 显示Mock规则的数据
- ✅ 禁用Mock管理系统 → 显示真实API的数据
- ✅ 后端未运行 → 显示加载失败提示

---

### 方案B：保留硬编码数据作为Fallback

**目标**：API失败时有数据兜底

**步骤**：
1. 保留硬编码数据
2. 优先尝试从API加载
3. API失败时fallback到硬编码数据
4. 显示数据来源标识

**效果**：
- ✅ API成功 → 显示API数据
- ✅ API失败 → 显示硬编码数据（带提示）
- ⚠️ 但仍然会让用户困惑

---

### 方案C：统一使用Mock管理系统（最佳）⭐⭐⭐

**目标**：所有Mock数据统一管理

**步骤**：
1. ✅ 删除页面硬编码数据
2. ✅ 页面初始化时调用API
3. ✅ 启用Mock管理系统供前端开发和演示
4. ✅ 禁用Mock使用真实数据

**优势**：
- ✅ 数据来源统一清晰
- ✅ 可以灵活切换Mock/真实数据
- ✅ Mock数据可视化管理
- ✅ 不会混淆

---

## 🚀 我立即帮你修复

**是否执行方案C - 清理所有硬编码数据？**

我将：
1. 清理所有AI监测页面的硬编码Mock数据
2. 改为在mounted时调用API
3. 确保同时支持Mock管理系统和真实API
4. 添加优雅的加载状态

预计时间：30-40分钟  
修改文件：4-6个Vue文件

**是否立即开始？**
