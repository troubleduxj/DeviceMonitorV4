# AIç›‘æµ‹æ¨¡å—åŒ–è®¾è®¡æ–¹æ¡ˆ

> **ç‰ˆæœ¬**: v1.0  
> **æ—¥æœŸ**: 2025-11-04  
> **ç›®çš„**: å°†AIç›‘æµ‹åŠŸèƒ½è®¾è®¡ä¸ºå¯æ’æ‹”ã€å¯é…ç½®çš„ç‹¬ç«‹æ¨¡å—

---

## ğŸ“‹ ç›®å½•

1. [è®¾è®¡ç›®æ ‡](#è®¾è®¡ç›®æ ‡)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [æ¨¡å—ç‹¬ç«‹æ€§è®¾è®¡](#æ¨¡å—ç‹¬ç«‹æ€§è®¾è®¡)
4. [åŠŸèƒ½å¼€å…³æ§åˆ¶](#åŠŸèƒ½å¼€å…³æ§åˆ¶)
5. [èµ„æºæ¶ˆè€—ä¼˜åŒ–](#èµ„æºæ¶ˆè€—ä¼˜åŒ–)
6. [å®æ–½æ–¹æ¡ˆ](#å®æ–½æ–¹æ¡ˆ)
7. [éƒ¨ç½²é…ç½®](#éƒ¨ç½²é…ç½®)

---

## 1. è®¾è®¡ç›®æ ‡

### 1.1 æ ¸å¿ƒç›®æ ‡

#### âœ… **æ¨¡å—åŒ–**
- AIç›‘æµ‹ä½œä¸ºç‹¬ç«‹æ¨¡å—ï¼Œä¸æ ¸å¿ƒä¸šåŠ¡è§£è€¦
- æ”¯æŒæ¨¡å—çš„ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²
- æ¨¡å—å¯ä»¥åœ¨ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½çš„æƒ…å†µä¸‹å¯ç”¨/ç¦ç”¨

#### âœ… **å¯é…ç½®æ€§**
- é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶AIåŠŸèƒ½å¯ç”¨/ç¦ç”¨
- æ”¯æŒç»†ç²’åº¦çš„åŠŸèƒ½å¼€å…³ï¼ˆå¦‚åªå¯ç”¨å¼‚å¸¸æ£€æµ‹ï¼Œä¸å¯ç”¨è¶‹åŠ¿é¢„æµ‹ï¼‰
- é…ç½®å¯åŠ¨æ€åŠ è½½ï¼Œæ— éœ€é‡å¯æœåŠ¡

#### âœ… **èµ„æºä¼˜åŒ–**
- AIåŠŸèƒ½ç¦ç”¨æ—¶ï¼Œä¸åŠ è½½ç›¸å…³Pythonåº“ï¼ˆèŠ‚çœå†…å­˜ï¼‰
- AIåŠŸèƒ½ç¦ç”¨æ—¶ï¼Œä¸å¯åŠ¨ç›¸å…³åå°ä»»åŠ¡ï¼ˆèŠ‚çœCPUï¼‰
- AIåŠŸèƒ½ç¦ç”¨æ—¶ï¼Œæ•°æ®åº“è¡¨å¯é€‰ä¸åˆ›å»ºï¼ˆèŠ‚çœå­˜å‚¨ï¼‰

#### âœ… **æ˜“ç»´æŠ¤æ€§**
- æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œï¼Œä¾¿äºå›¢é˜Ÿåˆ†å·¥
- ç‹¬ç«‹çš„ç‰ˆæœ¬ç®¡ç†ï¼Œå¯ä»¥å•ç‹¬å‡çº§AIæ¨¡å—
- å®Œå–„çš„é™çº§ç­–ç•¥ï¼ŒAIæ¨¡å—æ•…éšœä¸å½±å“æ ¸å¿ƒä¸šåŠ¡

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
DeviceMonitor ç³»ç»Ÿ
â”‚
â”œâ”€â”€ æ ¸å¿ƒæ¨¡å— (Core Modules) - å¿…éœ€
â”‚   â”œâ”€â”€ è®¾å¤‡ç®¡ç† (Device Management)
â”‚   â”œâ”€â”€ å®æ—¶ç›‘æ§ (Real-time Monitoring)
â”‚   â”œâ”€â”€ å‘Šè­¦ç®¡ç† (Alarm Management)
â”‚   â”œâ”€â”€ ç”¨æˆ·æƒé™ (User & Permission)
â”‚   â””â”€â”€ æ•°æ®é‡‡é›† (Data Collection)
â”‚
â””â”€â”€ æ‰©å±•æ¨¡å— (Extension Modules) - å¯é€‰
    â”‚
    â”œâ”€â”€ AIç›‘æµ‹æ¨¡å— (AI Monitoring Module) â­ æ–°å¢
    â”‚   â”œâ”€â”€ æ ¸å¿ƒæœåŠ¡ (Core Services)
    â”‚   â”‚   â”œâ”€â”€ ç‰¹å¾æå–æœåŠ¡ (Feature Extraction)
    â”‚   â”‚   â”œâ”€â”€ å¼‚å¸¸æ£€æµ‹æœåŠ¡ (Anomaly Detection)
    â”‚   â”‚   â”œâ”€â”€ è¶‹åŠ¿é¢„æµ‹æœåŠ¡ (Trend Prediction)
    â”‚   â”‚   â”œâ”€â”€ å¥åº·è¯„åˆ†æœåŠ¡ (Health Scoring)
    â”‚   â”‚   â””â”€â”€ æ™ºèƒ½åˆ†ææœåŠ¡ (Smart Analysis)
    â”‚   â”‚
    â”‚   â”œâ”€â”€ æ•°æ®å±‚ (Data Layer)
    â”‚   â”‚   â”œâ”€â”€ AIæ•°æ®æ¨¡å‹ (AI Models in DB)
    â”‚   â”‚   â””â”€â”€ ç‰¹å¾å­˜å‚¨ (Feature Storage)
    â”‚   â”‚
    â”‚   â”œâ”€â”€ APIå±‚ (API Layer)
    â”‚   â”‚   â””â”€â”€ /api/v2/ai/* (AIç›¸å…³API)
    â”‚   â”‚
    â”‚   â””â”€â”€ å‰ç«¯æ¨¡å— (Frontend Module)
    â”‚       â””â”€â”€ /ai-monitor/* (AIç›‘æµ‹é¡µé¢)
    â”‚
    â”œâ”€â”€ æŠ¥è¡¨æ¨¡å— (æœªæ¥)
    â”œâ”€â”€ å·¥ä½œæµæ¨¡å— (æœªæ¥)
    â””â”€â”€ ...
```

### 2.2 æ¨¡å—äº¤äº’è®¾è®¡

```mermaid
graph TB
    subgraph "æ ¸å¿ƒæ¨¡å—"
        A[è®¾å¤‡ç®¡ç†]
        B[æ•°æ®é‡‡é›†]
        C[å‘Šè­¦ç®¡ç†]
    end
    
    subgraph "AIç›‘æµ‹æ¨¡å—"
        D[ç‰¹å¾æå–]
        E[å¼‚å¸¸æ£€æµ‹]
        F[è¶‹åŠ¿é¢„æµ‹]
        G[å¥åº·è¯„åˆ†]
    end
    
    subgraph "æ•°æ®å±‚"
        H[(è®¾å¤‡æ•°æ®)]
        I[(AIæ•°æ®)]
    end
    
    A -->|è®¾å¤‡ä¿¡æ¯| B
    B -->|å®æ—¶æ•°æ®| H
    
    H -.->|æ•°æ®æŸ¥è¯¢| D
    D -.->|ç‰¹å¾æ•°æ®| E
    D -.->|ç‰¹å¾æ•°æ®| F
    D -.->|ç‰¹å¾æ•°æ®| G
    
    E -.->|æ£€æµ‹ç»“æœ| I
    F -.->|é¢„æµ‹ç»“æœ| I
    G -.->|è¯„åˆ†ç»“æœ| I
    
    E -.->|å¼‚å¸¸å‘Šè­¦| C
    
    style D fill:#e1f5ff
    style E fill:#e1f5ff
    style F fill:#e1f5ff
    style G fill:#e1f5ff
```

**è®¾è®¡åŸåˆ™**:
- **å•å‘ä¾èµ–**: AIæ¨¡å—ä¾èµ–æ ¸å¿ƒæ¨¡å—ï¼Œæ ¸å¿ƒæ¨¡å—ä¸ä¾èµ–AIæ¨¡å—
- **æ¾è€¦åˆ**: é€šè¿‡äº‹ä»¶/æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡ï¼Œè€Œéç›´æ¥è°ƒç”¨
- **å¯é™çº§**: AIæ¨¡å—æ•…éšœæ—¶ï¼Œæ ¸å¿ƒåŠŸèƒ½ä¸å—å½±å“

---

## 3. æ¨¡å—ç‹¬ç«‹æ€§è®¾è®¡

### 3.1 ç›®å½•ç»“æ„

```
DeviceMonitorV2/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ init_app.py
â”‚   â”‚   â”œâ”€â”€ dependency.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ admin.py             # æ ¸å¿ƒæ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ device.py
â”‚   â”‚   â””â”€â”€ ai_monitoring.py     # AIæ¨¡å—æ•°æ®æ¨¡å‹ (å¯é€‰åŠ è½½)
â”‚   â”‚
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ v2/
â”‚   â”‚   â”‚   â”œâ”€â”€ devices.py       # æ ¸å¿ƒAPI
â”‚   â”‚   â”‚   â”œâ”€â”€ alarms.py
â”‚   â”‚   â”‚   â””â”€â”€ ai/              # AIæ¨¡å—API (ç‹¬ç«‹ç›®å½•)
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ features.py
â”‚   â”‚   â”‚       â”œâ”€â”€ anomaly.py
â”‚   â”‚   â”‚       â”œâ”€â”€ prediction.py
â”‚   â”‚   â”‚       â””â”€â”€ analysis.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ device_service.py    # æ ¸å¿ƒæœåŠ¡
â”‚   â”‚   â””â”€â”€ ai/                  # AIæ¨¡å—æœåŠ¡ (ç‹¬ç«‹ç›®å½•)
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ feature_service.py
â”‚   â”‚       â”œâ”€â”€ anomaly_detector.py
â”‚   â”‚       â”œâ”€â”€ trend_predictor.py
â”‚   â”‚       â””â”€â”€ health_scorer.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ai_module/               # â­ AIæ¨¡å—å…¥å£
â”‚   â”‚   â”œâ”€â”€ __init__.py          # æ¨¡å—åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ config.py            # AIé…ç½®
â”‚   â”‚   â”œâ”€â”€ router.py            # AIè·¯ç”±æ³¨å†Œ
â”‚   â”‚   â”œâ”€â”€ loader.py            # å»¶è¿ŸåŠ è½½å™¨
â”‚   â”‚   â””â”€â”€ registry.py          # æœåŠ¡æ³¨å†Œè¡¨
â”‚   â”‚
â”‚   â””â”€â”€ settings/
â”‚       â”œâ”€â”€ base.py
â”‚       â””â”€â”€ ai_settings.py       # AIæ¨¡å—é…ç½®
â”‚
â”œâ”€â”€ web/src/
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ device/              # æ ¸å¿ƒé¡µé¢
â”‚   â”‚   â””â”€â”€ ai-monitor/          # AIæ¨¡å—é¡µé¢ (ç‹¬ç«‹ç›®å½•)
â”‚   â”‚
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ ai-monitor-v2.js     # AIæ¨¡å—APIå®¢æˆ·ç«¯
â”‚   â”‚
â”‚   â””â”€â”€ router/
â”‚       â””â”€â”€ modules/
â”‚           â”œâ”€â”€ device.js        # æ ¸å¿ƒè·¯ç”±
â”‚           â””â”€â”€ ai-monitor.ts    # AIæ¨¡å—è·¯ç”±
â”‚
â””â”€â”€ database/
    â””â”€â”€ migrations/
        â”œâ”€â”€ core/                # æ ¸å¿ƒæ•°æ®åº“è¿ç§»
        â””â”€â”€ ai_module/           # AIæ¨¡å—æ•°æ®åº“è¿ç§» (å¯é€‰æ‰§è¡Œ)
```

### 3.2 æ¨¡å—ç‹¬ç«‹æ€§æ£€æŸ¥æ¸…å•

| æ£€æŸ¥é¡¹ | è¦æ±‚ | å®ç°æ–¹å¼ |
|--------|------|----------|
| âœ… ä»£ç éš”ç¦» | AIä»£ç åœ¨ç‹¬ç«‹ç›®å½• | `app/ai_module/`, `app/api/v2/ai/` |
| âœ… é…ç½®éš”ç¦» | AIé…ç½®ç‹¬ç«‹æ–‡ä»¶ | `app/settings/ai_settings.py` |
| âœ… æ•°æ®åº“éš”ç¦» | AIè¡¨å¯é€‰åˆ›å»º | æ¡ä»¶æ€§è¿ç§»è„šæœ¬ |
| âœ… ä¾èµ–éš”ç¦» | AIä¾èµ–å¯é€‰å®‰è£… | `requirements-ai.txt` (å¯é€‰) |
| âœ… APIéš”ç¦» | AI APIç‹¬ç«‹è·¯ç”± | `/api/v2/ai/*` |
| âœ… å‰ç«¯éš”ç¦» | AIé¡µé¢ç‹¬ç«‹ç›®å½• | `web/src/views/ai-monitor/` |
| âœ… å¯åŠ¨éš”ç¦» | AIæ¨¡å—æ¡ä»¶åŠ è½½ | é€šè¿‡é…ç½®æ§åˆ¶ |

---

## 4. åŠŸèƒ½å¼€å…³æ§åˆ¶

### 4.1 é…ç½®æ–‡ä»¶è®¾è®¡

#### 4.1.1 å…¨å±€å¼€å…³ (`.env`)

```bash
# ================================
# AIç›‘æµ‹æ¨¡å—é…ç½®
# ================================

# æ˜¯å¦å¯ç”¨AIç›‘æµ‹æ¨¡å— (true/false)
AI_MODULE_ENABLED=true

# AIåŠŸèƒ½ç»†ç²’åº¦æ§åˆ¶ (å¯é€‰ï¼Œé»˜è®¤å…¨éƒ¨å¯ç”¨)
AI_FEATURE_EXTRACTION_ENABLED=true    # ç‰¹å¾æå–
AI_ANOMALY_DETECTION_ENABLED=true     # å¼‚å¸¸æ£€æµ‹
AI_TREND_PREDICTION_ENABLED=true      # è¶‹åŠ¿é¢„æµ‹
AI_HEALTH_SCORING_ENABLED=true        # å¥åº·è¯„åˆ†
AI_SMART_ANALYSIS_ENABLED=true        # æ™ºèƒ½åˆ†æ
AI_DATA_ANNOTATION_ENABLED=false      # æ•°æ®æ ‡æ³¨ (å¯é€‰åŠŸèƒ½)

# AIæ¨¡å—èµ„æºé™åˆ¶
AI_MAX_MEMORY_MB=1024                 # æœ€å¤§å†…å­˜ä½¿ç”¨ (MB)
AI_MAX_CPU_PERCENT=50                 # æœ€å¤§CPUä½¿ç”¨ (%)
AI_WORKER_THREADS=2                   # å·¥ä½œçº¿ç¨‹æ•°

# AIæ¨¡å‹è·¯å¾„
AI_MODELS_PATH=/data/ai_models        # æ¨¡å‹æ–‡ä»¶å­˜å‚¨è·¯å¾„

# AIåå°ä»»åŠ¡
AI_BACKGROUND_TASKS_ENABLED=true      # æ˜¯å¦å¯ç”¨åå°ä»»åŠ¡
AI_TASK_SCHEDULE_INTERVAL=300         # ä»»åŠ¡è°ƒåº¦é—´éš”(ç§’)

# ä¾èµ–æœåŠ¡
AI_REQUIRE_GPU=false                  # æ˜¯å¦éœ€è¦GPU
AI_REQUIRE_CELERY=false               # æ˜¯å¦éœ€è¦Celery (å¼‚æ­¥ä»»åŠ¡)
```

#### 4.1.2 Pythoné…ç½®ç±» (`app/settings/ai_settings.py`)

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
AIç›‘æµ‹æ¨¡å—é…ç½®
"""

from typing import Optional, Dict, Any
from pydantic import BaseSettings, Field, validator
import os


class AIModuleSettings(BaseSettings):
    """AIæ¨¡å—é…ç½®"""
    
    # ==================== å…¨å±€å¼€å…³ ====================
    
    ai_module_enabled: bool = Field(
        default=False,
        env='AI_MODULE_ENABLED',
        description='æ˜¯å¦å¯ç”¨AIç›‘æµ‹æ¨¡å—'
    )
    
    # ==================== åŠŸèƒ½å¼€å…³ ====================
    
    ai_feature_extraction_enabled: bool = Field(
        default=True,
        env='AI_FEATURE_EXTRACTION_ENABLED'
    )
    
    ai_anomaly_detection_enabled: bool = Field(
        default=True,
        env='AI_ANOMALY_DETECTION_ENABLED'
    )
    
    ai_trend_prediction_enabled: bool = Field(
        default=True,
        env='AI_TREND_PREDICTION_ENABLED'
    )
    
    ai_health_scoring_enabled: bool = Field(
        default=True,
        env='AI_HEALTH_SCORING_ENABLED'
    )
    
    ai_smart_analysis_enabled: bool = Field(
        default=True,
        env='AI_SMART_ANALYSIS_ENABLED'
    )
    
    ai_data_annotation_enabled: bool = Field(
        default=False,
        env='AI_DATA_ANNOTATION_ENABLED'
    )
    
    # ==================== èµ„æºé™åˆ¶ ====================
    
    ai_max_memory_mb: int = Field(
        default=1024,
        env='AI_MAX_MEMORY_MB',
        description='AIæ¨¡å—æœ€å¤§å†…å­˜ä½¿ç”¨(MB)'
    )
    
    ai_max_cpu_percent: int = Field(
        default=50,
        ge=1,
        le=100,
        env='AI_MAX_CPU_PERCENT',
        description='AIæ¨¡å—æœ€å¤§CPUä½¿ç”¨ç‡(%)'
    )
    
    ai_worker_threads: int = Field(
        default=2,
        ge=1,
        env='AI_WORKER_THREADS',
        description='AIå·¥ä½œçº¿ç¨‹æ•°'
    )
    
    # ==================== è·¯å¾„é…ç½® ====================
    
    ai_models_path: str = Field(
        default='/data/ai_models',
        env='AI_MODELS_PATH',
        description='AIæ¨¡å‹æ–‡ä»¶å­˜å‚¨è·¯å¾„'
    )
    
    # ==================== åå°ä»»åŠ¡ ====================
    
    ai_background_tasks_enabled: bool = Field(
        default=True,
        env='AI_BACKGROUND_TASKS_ENABLED'
    )
    
    ai_task_schedule_interval: int = Field(
        default=300,
        env='AI_TASK_SCHEDULE_INTERVAL',
        description='AIä»»åŠ¡è°ƒåº¦é—´éš”(ç§’)'
    )
    
    # ==================== ä¾èµ–æœåŠ¡ ====================
    
    ai_require_gpu: bool = Field(
        default=False,
        env='AI_REQUIRE_GPU'
    )
    
    ai_require_celery: bool = Field(
        default=False,
        env='AI_REQUIRE_CELERY'
    )
    
    # ==================== éªŒè¯å™¨ ====================
    
    @validator('ai_models_path')
    def validate_models_path(cls, v):
        """éªŒè¯æ¨¡å‹è·¯å¾„"""
        if not os.path.isabs(v):
            # ç›¸å¯¹è·¯å¾„è½¬ç»å¯¹è·¯å¾„
            v = os.path.abspath(v)
        return v
    
    # ==================== åŠŸèƒ½æ£€æŸ¥ ====================
    
    def is_feature_enabled(self, feature_name: str) -> bool:
        """æ£€æŸ¥ç‰¹å®šåŠŸèƒ½æ˜¯å¦å¯ç”¨"""
        if not self.ai_module_enabled:
            return False
        
        feature_map = {
            'feature_extraction': self.ai_feature_extraction_enabled,
            'anomaly_detection': self.ai_anomaly_detection_enabled,
            'trend_prediction': self.ai_trend_prediction_enabled,
            'health_scoring': self.ai_health_scoring_enabled,
            'smart_analysis': self.ai_smart_analysis_enabled,
            'data_annotation': self.ai_data_annotation_enabled,
        }
        
        return feature_map.get(feature_name, False)
    
    def get_enabled_features(self) -> list:
        """è·å–æ‰€æœ‰å¯ç”¨çš„åŠŸèƒ½åˆ—è¡¨"""
        if not self.ai_module_enabled:
            return []
        
        features = []
        if self.ai_feature_extraction_enabled:
            features.append('feature_extraction')
        if self.ai_anomaly_detection_enabled:
            features.append('anomaly_detection')
        if self.ai_trend_prediction_enabled:
            features.append('trend_prediction')
        if self.ai_health_scoring_enabled:
            features.append('health_scoring')
        if self.ai_smart_analysis_enabled:
            features.append('smart_analysis')
        if self.ai_data_annotation_enabled:
            features.append('data_annotation')
        
        return features
    
    class Config:
        env_file = '.env'
        env_file_encoding = 'utf-8'


# åˆ›å»ºå…¨å±€å®ä¾‹
ai_settings = AIModuleSettings()
```

### 4.2 æ¡ä»¶åŠ è½½æœºåˆ¶

#### 4.2.1 AIæ¨¡å—åŠ è½½å™¨ (`app/ai_module/loader.py`)

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
AIæ¨¡å—å»¶è¿ŸåŠ è½½å™¨
"""

import sys
import importlib
from typing import Optional, Dict, Any
from loguru import logger

from app.settings.ai_settings import ai_settings


class AIModuleLoader:
    """AIæ¨¡å—å»¶è¿ŸåŠ è½½å™¨"""
    
    def __init__(self):
        self._loaded = False
        self._services = {}
        self._routers = []
    
    def is_enabled(self) -> bool:
        """æ£€æŸ¥AIæ¨¡å—æ˜¯å¦å¯ç”¨"""
        return ai_settings.ai_module_enabled
    
    def load_module(self) -> bool:
        """åŠ è½½AIæ¨¡å—"""
        if self._loaded:
            logger.warning("AIæ¨¡å—å·²åŠ è½½ï¼Œè·³è¿‡")
            return True
        
        if not self.is_enabled():
            logger.info("AIæ¨¡å—æœªå¯ç”¨ï¼Œè·³è¿‡åŠ è½½")
            return False
        
        try:
            logger.info("å¼€å§‹åŠ è½½AIæ¨¡å—...")
            
            # 1. æ£€æŸ¥ä¾èµ–
            self._check_dependencies()
            
            # 2. åŠ è½½AIåº“ (å»¶è¿Ÿå¯¼å…¥)
            self._load_ai_libraries()
            
            # 3. æ³¨å†ŒæœåŠ¡
            self._register_services()
            
            # 4. æ³¨å†Œè·¯ç”±
            self._register_routers()
            
            # 5. å¯åŠ¨åå°ä»»åŠ¡
            if ai_settings.ai_background_tasks_enabled:
                self._start_background_tasks()
            
            self._loaded = True
            logger.success("âœ… AIæ¨¡å—åŠ è½½æˆåŠŸ")
            
            # æ‰“å°å¯ç”¨çš„åŠŸèƒ½
            enabled_features = ai_settings.get_enabled_features()
            logger.info(f"å¯ç”¨çš„AIåŠŸèƒ½: {', '.join(enabled_features)}")
            
            return True
        
        except Exception as e:
            logger.error(f"âŒ AIæ¨¡å—åŠ è½½å¤±è´¥: {str(e)}")
            logger.exception(e)
            return False
    
    def _check_dependencies(self):
        """æ£€æŸ¥ä¾èµ–"""
        missing_deps = []
        
        # æ£€æŸ¥å¿…éœ€çš„Pythonåº“
        required_libs = ['numpy', 'pandas', 'scikit-learn']
        
        for lib in required_libs:
            try:
                importlib.import_module(lib)
            except ImportError:
                missing_deps.append(lib)
        
        if missing_deps:
            raise ImportError(
                f"ç¼ºå°‘AIæ¨¡å—ä¾èµ–: {', '.join(missing_deps)}\n"
                f"è¯·è¿è¡Œ: pip install {' '.join(missing_deps)}"
            )
        
        # æ£€æŸ¥GPU (å¦‚æœéœ€è¦)
        if ai_settings.ai_require_gpu:
            try:
                import torch
                if not torch.cuda.is_available():
                    logger.warning("âš ï¸ é…ç½®è¦æ±‚GPUï¼Œä½†GPUä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨CPU")
            except ImportError:
                raise ImportError("é…ç½®è¦æ±‚GPUï¼Œä½†æœªå®‰è£…torchåº“")
        
        # æ£€æŸ¥Celery (å¦‚æœéœ€è¦)
        if ai_settings.ai_require_celery:
            try:
                import celery
            except ImportError:
                raise ImportError("é…ç½®è¦æ±‚Celeryï¼Œä½†æœªå®‰è£…celeryåº“")
        
        logger.info("âœ… ä¾èµ–æ£€æŸ¥é€šè¿‡")
    
    def _load_ai_libraries(self):
        """å»¶è¿ŸåŠ è½½AIåº“ (èŠ‚çœå¯åŠ¨å†…å­˜)"""
        logger.info("åŠ è½½AIåº“...")
        
        # åªåœ¨å¯ç”¨æ—¶å¯¼å…¥ï¼Œé¿å…ä¸å¿…è¦çš„å†…å­˜å ç”¨
        if ai_settings.ai_feature_extraction_enabled:
            global numpy, pandas
            import numpy
            import pandas
            logger.debug("  âœ“ numpy, pandas")
        
        if ai_settings.ai_anomaly_detection_enabled or \
           ai_settings.ai_trend_prediction_enabled:
            global sklearn
            import sklearn
            logger.debug("  âœ“ scikit-learn")
        
        # å…¶ä»–åº“...
        
        logger.info("âœ… AIåº“åŠ è½½å®Œæˆ")
    
    def _register_services(self):
        """æ³¨å†ŒAIæœåŠ¡"""
        logger.info("æ³¨å†ŒAIæœåŠ¡...")
        
        # ç‰¹å¾æå–æœåŠ¡
        if ai_settings.ai_feature_extraction_enabled:
            from app.services.ai.feature_service import AIFeatureService
            self._services['feature_service'] = AIFeatureService()
            logger.debug("  âœ“ ç‰¹å¾æå–æœåŠ¡")
        
        # å¼‚å¸¸æ£€æµ‹æœåŠ¡
        if ai_settings.ai_anomaly_detection_enabled:
            from app.services.ai.anomaly_detector import AnomalyDetector
            self._services['anomaly_detector'] = AnomalyDetector()
            logger.debug("  âœ“ å¼‚å¸¸æ£€æµ‹æœåŠ¡")
        
        # è¶‹åŠ¿é¢„æµ‹æœåŠ¡
        if ai_settings.ai_trend_prediction_enabled:
            from app.services.ai.trend_predictor import TrendPredictor
            self._services['trend_predictor'] = TrendPredictor()
            logger.debug("  âœ“ è¶‹åŠ¿é¢„æµ‹æœåŠ¡")
        
        # å¥åº·è¯„åˆ†æœåŠ¡
        if ai_settings.ai_health_scoring_enabled:
            from app.services.ai.health_scorer import HealthScorer
            self._services['health_scorer'] = HealthScorer()
            logger.debug("  âœ“ å¥åº·è¯„åˆ†æœåŠ¡")
        
        # æ™ºèƒ½åˆ†ææœåŠ¡
        if ai_settings.ai_smart_analysis_enabled:
            from app.services.ai.smart_analyzer import SmartAnalyzer
            self._services['smart_analyzer'] = SmartAnalyzer()
            logger.debug("  âœ“ æ™ºèƒ½åˆ†ææœåŠ¡")
        
        logger.info(f"âœ… æ³¨å†Œäº† {len(self._services)} ä¸ªAIæœåŠ¡")
    
    def _register_routers(self):
        """æ³¨å†ŒAIè·¯ç”±"""
        logger.info("æ³¨å†ŒAIè·¯ç”±...")
        
        # ç‰¹å¾æå–API
        if ai_settings.ai_feature_extraction_enabled:
            from app.api.v2.ai.features import router as features_router
            self._routers.append(features_router)
            logger.debug("  âœ“ ç‰¹å¾æå–API")
        
        # å¼‚å¸¸æ£€æµ‹API
        if ai_settings.ai_anomaly_detection_enabled:
            from app.api.v2.ai.anomaly import router as anomaly_router
            self._routers.append(anomaly_router)
            logger.debug("  âœ“ å¼‚å¸¸æ£€æµ‹API")
        
        # è¶‹åŠ¿é¢„æµ‹API
        if ai_settings.ai_trend_prediction_enabled:
            from app.api.v2.ai.prediction import router as prediction_router
            self._routers.append(prediction_router)
            logger.debug("  âœ“ è¶‹åŠ¿é¢„æµ‹API")
        
        # å¥åº·è¯„åˆ†API
        if ai_settings.ai_health_scoring_enabled:
            from app.api.v2.ai.health import router as health_router
            self._routers.append(health_router)
            logger.debug("  âœ“ å¥åº·è¯„åˆ†API")
        
        # æ™ºèƒ½åˆ†æAPI
        if ai_settings.ai_smart_analysis_enabled:
            from app.api.v2.ai.analysis import router as analysis_router
            self._routers.append(analysis_router)
            logger.debug("  âœ“ æ™ºèƒ½åˆ†æAPI")
        
        logger.info(f"âœ… æ³¨å†Œäº† {len(self._routers)} ä¸ªAIè·¯ç”±")
    
    def _start_background_tasks(self):
        """å¯åŠ¨åå°ä»»åŠ¡"""
        logger.info("å¯åŠ¨AIåå°ä»»åŠ¡...")
        
        # å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
        from app.ai_module.scheduler import AITaskScheduler
        scheduler = AITaskScheduler()
        scheduler.start()
        
        logger.info("âœ… AIåå°ä»»åŠ¡å·²å¯åŠ¨")
    
    def get_service(self, service_name: str) -> Optional[Any]:
        """è·å–AIæœåŠ¡å®ä¾‹"""
        return self._services.get(service_name)
    
    def get_routers(self) -> list:
        """è·å–æ‰€æœ‰AIè·¯ç”±"""
        return self._routers
    
    def unload_module(self):
        """å¸è½½AIæ¨¡å— (ç”¨äºçƒ­é‡è½½)"""
        if not self._loaded:
            return
        
        logger.info("å¸è½½AIæ¨¡å—...")
        
        # åœæ­¢åå°ä»»åŠ¡
        # æ¸…ç†æœåŠ¡
        self._services.clear()
        self._routers.clear()
        
        self._loaded = False
        logger.info("âœ… AIæ¨¡å—å·²å¸è½½")


# åˆ›å»ºå…¨å±€åŠ è½½å™¨å®ä¾‹
ai_loader = AIModuleLoader()
```

#### 4.2.2 é›†æˆåˆ°FastAPIå¯åŠ¨ (`app/core/init_app.py`)

```python
# app/core/init_app.py

from fastapi import FastAPI
from app.settings.ai_settings import ai_settings
from app.ai_module.loader import ai_loader


async def init_ai_module(app: FastAPI):
    """åˆå§‹åŒ–AIæ¨¡å—"""
    logger.info("åˆå§‹åŒ–AIæ¨¡å—...")
    
    # æ£€æŸ¥æ˜¯å¦å¯ç”¨
    if not ai_settings.ai_module_enabled:
        logger.info("â¸ï¸ AIæ¨¡å—æœªå¯ç”¨ï¼Œè·³è¿‡åˆå§‹åŒ–")
        return
    
    # åŠ è½½æ¨¡å—
    success = ai_loader.load_module()
    
    if success:
        # æ³¨å†Œè·¯ç”±åˆ°FastAPI
        for router in ai_loader.get_routers():
            app.include_router(
                router,
                prefix="/api/v2/ai",
                tags=["AIç›‘æµ‹"]
            )
        
        logger.success("âœ… AIæ¨¡å—åˆå§‹åŒ–å®Œæˆ")
    else:
        logger.warning("âš ï¸ AIæ¨¡å—åˆå§‹åŒ–å¤±è´¥ï¼Œæ ¸å¿ƒåŠŸèƒ½ä¸å—å½±å“")


# åœ¨create_appä¸­è°ƒç”¨
def create_app() -> FastAPI:
    app = FastAPI(...)
    
    # åˆå§‹åŒ–æ ¸å¿ƒåŠŸèƒ½
    await init_db(app)
    await init_cache(app)
    ...
    
    # åˆå§‹åŒ–AIæ¨¡å— (å¯é€‰)
    await init_ai_module(app)
    
    return app
```

### 4.3 å‰ç«¯åŠŸèƒ½å¼€å…³

#### 4.3.1 åŠ¨æ€è·¯ç”±æ³¨å†Œ (`web/src/router/index.js`)

```javascript
// web/src/router/index.js

import { createRouter } from 'vue-router'
import { apiV2 } from '@/api/v2'

// æ ¸å¿ƒè·¯ç”± (å§‹ç»ˆåŠ è½½)
const coreRoutes = [
  {
    path: '/dashboard',
    component: () => import('@/views/dashboard/index.vue'),
    meta: { title: 'å·¥ä½œå°' }
  },
  {
    path: '/device',
    component: () => import('@/views/device/index.vue'),
    meta: { title: 'è®¾å¤‡ç®¡ç†' }
  },
  // ...
]

// AIæ¨¡å—è·¯ç”± (æ¡ä»¶åŠ è½½)
async function loadAIRoutes() {
  try {
    // æ£€æŸ¥åç«¯AIæ¨¡å—æ˜¯å¦å¯ç”¨
    const response = await apiV2.system.getModuleConfig('ai_module')
    
    if (response.data?.enabled) {
      console.log('âœ… AIæ¨¡å—å·²å¯ç”¨ï¼ŒåŠ è½½AIè·¯ç”±')
      
      // åŠ¨æ€å¯¼å…¥AIè·¯ç”±
      const aiRouteModule = await import('@/views/ai-monitor/route.ts')
      return [aiRouteModule.default]
    } else {
      console.log('â¸ï¸ AIæ¨¡å—æœªå¯ç”¨ï¼Œè·³è¿‡AIè·¯ç”±')
      return []
    }
  } catch (error) {
    console.error('æ£€æŸ¥AIæ¨¡å—çŠ¶æ€å¤±è´¥:', error)
    return []
  }
}

// åˆ›å»ºè·¯ç”±
export async function createAppRouter() {
  const aiRoutes = await loadAIRoutes()
  
  const router = createRouter({
    history: createWebHistory(),
    routes: [
      ...coreRoutes,
      ...aiRoutes  // æ¡ä»¶æ€§æ·»åŠ AIè·¯ç”±
    ]
  })
  
  return router
}
```

#### 4.3.2 èœå•åŠ¨æ€æ˜¾ç¤º (`web/src/layout/components/SideMenu.vue`)

```vue
<!-- web/src/layout/components/SideMenu.vue -->

<script setup>
import { computed } from 'vue'
import { usePermissionStore } from '@/store'
import { useAIModuleStore } from '@/store/modules/ai-module'

const permissionStore = usePermissionStore()
const aiModuleStore = useAIModuleStore()

// è¿‡æ»¤èœå•ï¼šæ ¹æ®æƒé™ + AIæ¨¡å—çŠ¶æ€
const filteredMenus = computed(() => {
  return permissionStore.menus.filter(menu => {
    // æ£€æŸ¥æƒé™
    if (!hasPermission(menu)) {
      return false
    }
    
    // å¦‚æœæ˜¯AIæ¨¡å—èœå•ï¼Œæ£€æŸ¥AIæ¨¡å—æ˜¯å¦å¯ç”¨
    if (menu.path?.startsWith('/ai-monitor')) {
      return aiModuleStore.isEnabled
    }
    
    return true
  })
})
</script>

<template>
  <n-menu :options="filteredMenus" />
</template>
```

#### 4.3.3 AIæ¨¡å—çŠ¶æ€Store (`web/src/store/modules/ai-module.js`)

```javascript
// web/src/store/modules/ai-module.js

import { defineStore } from 'pinia'
import { apiV2 } from '@/api/v2'

export const useAIModuleStore = defineStore('ai-module', {
  state: () => ({
    enabled: false,           // AIæ¨¡å—æ˜¯å¦å¯ç”¨
    features: {},             // ç»†åˆ†åŠŸèƒ½å¼€å…³
    config: {},               // AIæ¨¡å—é…ç½®
    loading: false,
    error: null
  }),
  
  getters: {
    isEnabled: (state) => state.enabled,
    
    isFeatureEnabled: (state) => (featureName) => {
      return state.enabled && (state.features[featureName] !== false)
    }
  },
  
  actions: {
    async fetchModuleStatus() {
      this.loading = true
      try {
        const response = await apiV2.system.getModuleConfig('ai_module')
        
        this.enabled = response.data?.enabled || false
        this.features = response.data?.features || {}
        this.config = response.data?.config || {}
        
        console.log('AIæ¨¡å—çŠ¶æ€:', {
          enabled: this.enabled,
          features: Object.keys(this.features).filter(k => this.features[k])
        })
      } catch (error) {
        console.error('è·å–AIæ¨¡å—çŠ¶æ€å¤±è´¥:', error)
        this.error = error
        this.enabled = false  // å‡ºé”™æ—¶é»˜è®¤ç¦ç”¨
      } finally {
        this.loading = false
      }
    }
  }
})
```

---

## 5. èµ„æºæ¶ˆè€—ä¼˜åŒ–

### 5.1 å†…å­˜ä¼˜åŒ–

#### 5.1.1 å»¶è¿ŸåŠ è½½ç­–ç•¥

```python
# âŒ ä¸å¥½çš„åšæ³• (å¯åŠ¨æ—¶å…¨éƒ¨åŠ è½½)
import numpy as np
import pandas as pd
import sklearn
import torch

# âœ… å¥½çš„åšæ³• (ä½¿ç”¨æ—¶æ‰åŠ è½½)
def get_anomaly_detector():
    if not ai_settings.ai_anomaly_detection_enabled:
        raise RuntimeError("å¼‚å¸¸æ£€æµ‹åŠŸèƒ½æœªå¯ç”¨")
    
    # å»¶è¿Ÿå¯¼å…¥
    from sklearn.ensemble import IsolationForest
    import numpy as np
    
    detector = IsolationForest(...)
    return detector
```

#### 5.1.2 æ¨¡å‹ç¼“å­˜ç®¡ç†

```python
# app/ai_module/model_cache.py

from typing import Optional, Dict, Any
import psutil
from loguru import logger


class ModelCache:
    """AIæ¨¡å‹ç¼“å­˜ç®¡ç†"""
    
    def __init__(self, max_memory_mb: int = 1024):
        self._cache = {}
        self._max_memory_mb = max_memory_mb
    
    def get(self, model_id: str) -> Optional[Any]:
        """è·å–ç¼“å­˜çš„æ¨¡å‹"""
        return self._cache.get(model_id)
    
    def set(self, model_id: str, model: Any):
        """ç¼“å­˜æ¨¡å‹"""
        # æ£€æŸ¥å†…å­˜ä½¿ç”¨
        current_memory_mb = self._get_memory_usage_mb()
        
        if current_memory_mb > self._max_memory_mb:
            logger.warning(f"å†…å­˜ä½¿ç”¨è¶…è¿‡é™åˆ¶ ({current_memory_mb}MB > {self._max_memory_mb}MB), æ¸…ç†ç¼“å­˜")
            self._evict_oldest()
        
        self._cache[model_id] = {
            'model': model,
            'last_access': time.time()
        }
    
    def clear(self):
        """æ¸…ç©ºç¼“å­˜"""
        self._cache.clear()
        logger.info("æ¨¡å‹ç¼“å­˜å·²æ¸…ç©º")
    
    def _get_memory_usage_mb(self) -> float:
        """è·å–å½“å‰è¿›ç¨‹å†…å­˜ä½¿ç”¨(MB)"""
        process = psutil.Process()
        return process.memory_info().rss / 1024 / 1024
    
    def _evict_oldest(self):
        """é©±é€æœ€æ—§çš„ç¼“å­˜"""
        if not self._cache:
            return
        
        # æŒ‰æœ€åè®¿é—®æ—¶é—´æ’åº
        sorted_items = sorted(
            self._cache.items(),
            key=lambda x: x[1]['last_access']
        )
        
        # åˆ é™¤æœ€æ—§çš„50%
        evict_count = len(sorted_items) // 2
        for model_id, _ in sorted_items[:evict_count]:
            del self._cache[model_id]
        
        logger.info(f"é©±é€äº† {evict_count} ä¸ªæ¨¡å‹ç¼“å­˜")
```

### 5.2 CPUä¼˜åŒ–

#### 5.2.1 çº¿ç¨‹æ± ç®¡ç†

```python
# app/ai_module/thread_pool.py

from concurrent.futures import ThreadPoolExecutor
from app.settings.ai_settings import ai_settings


class AIThreadPool:
    """AIä»»åŠ¡çº¿ç¨‹æ± """
    
    def __init__(self):
        self._executor = None
    
    def initialize(self):
        """åˆå§‹åŒ–çº¿ç¨‹æ± """
        if self._executor is None:
            self._executor = ThreadPoolExecutor(
                max_workers=ai_settings.ai_worker_threads,
                thread_name_prefix='ai-worker-'
            )
            logger.info(f"AIçº¿ç¨‹æ± åˆå§‹åŒ–å®Œæˆï¼Œå·¥ä½œçº¿ç¨‹æ•°: {ai_settings.ai_worker_threads}")
    
    def submit(self, fn, *args, **kwargs):
        """æäº¤ä»»åŠ¡"""
        if self._executor is None:
            raise RuntimeError("çº¿ç¨‹æ± æœªåˆå§‹åŒ–")
        
        return self._executor.submit(fn, *args, **kwargs)
    
    def shutdown(self):
        """å…³é—­çº¿ç¨‹æ± """
        if self._executor is not None:
            self._executor.shutdown(wait=True)
            self._executor = None
            logger.info("AIçº¿ç¨‹æ± å·²å…³é—­")


# å…¨å±€çº¿ç¨‹æ± 
ai_thread_pool = AIThreadPool()
```

#### 5.2.2 CPUé™åˆ¶

```python
# app/ai_module/resource_limiter.py

import os
import psutil
from loguru import logger


class ResourceLimiter:
    """èµ„æºé™åˆ¶å™¨"""
    
    @staticmethod
    def limit_cpu_affinity():
        """é™åˆ¶CPUäº²å’Œæ€§ (é™åˆ¶ä½¿ç”¨çš„CPUæ ¸å¿ƒ)"""
        cpu_count = psutil.cpu_count()
        max_cpu_percent = ai_settings.ai_max_cpu_percent
        
        # è®¡ç®—å¯ç”¨æ ¸å¿ƒæ•°
        allowed_cores = max(1, int(cpu_count * max_cpu_percent / 100))
        
        # è®¾ç½®CPUäº²å’Œæ€§
        process = psutil.Process()
        available_cpus = list(range(allowed_cores))
        process.cpu_affinity(available_cpus)
        
        logger.info(f"AIæ¨¡å—CPUé™åˆ¶: {allowed_cores}/{cpu_count} æ ¸å¿ƒ ({max_cpu_percent}%)")
```

### 5.3 æ•°æ®åº“ä¼˜åŒ–

#### 5.3.1 æ¡ä»¶æ€§è¡¨åˆ›å»º

```sql
-- database/migrations/ai_module/001_create_ai_tables.sql

-- æ£€æŸ¥AIæ¨¡å—æ˜¯å¦å¯ç”¨ (é€šè¿‡ç¯å¢ƒå˜é‡æˆ–é…ç½®è¡¨)
DO $$
BEGIN
    -- è¯»å–é…ç½®
    IF EXISTS (
        SELECT 1 FROM t_sys_config 
        WHERE key = 'AI_MODULE_ENABLED' AND value = 'true'
    ) THEN
        -- AIæ¨¡å—å¯ç”¨ï¼Œåˆ›å»ºè¡¨
        
        -- AIé¢„æµ‹è¡¨
        CREATE TABLE IF NOT EXISTS t_ai_predictions (
            id BIGSERIAL PRIMARY KEY,
            prediction_name VARCHAR(200) NOT NULL,
            -- ...
        );
        
        -- AIæ¨¡å‹è¡¨
        CREATE TABLE IF NOT EXISTS t_ai_models (
            id BIGSERIAL PRIMARY KEY,
            model_name VARCHAR(200) NOT NULL,
            -- ...
        );
        
        -- AIåˆ†æè¡¨
        CREATE TABLE IF NOT EXISTS t_ai_analysis (
            id BIGSERIAL PRIMARY KEY,
            analysis_name VARCHAR(200) NOT NULL,
            -- ...
        );
        
        RAISE NOTICE 'AIæ¨¡å—æ•°æ®è¡¨åˆ›å»ºå®Œæˆ';
    ELSE
        RAISE NOTICE 'AIæ¨¡å—æœªå¯ç”¨ï¼Œè·³è¿‡è¡¨åˆ›å»º';
    END IF;
END $$;
```

#### 5.3.2 æ•°æ®æ¸…ç†ç­–ç•¥

```python
# app/ai_module/data_cleaner.py

from datetime import datetime, timedelta
from loguru import logger


class AIDataCleaner:
    """AIæ•°æ®æ¸…ç†å™¨"""
    
    @staticmethod
    async def clean_old_data(days_to_keep: int = 90):
        """æ¸…ç†æ—§æ•°æ®"""
        if not ai_settings.ai_module_enabled:
            return
        
        logger.info(f"å¼€å§‹æ¸…ç† {days_to_keep} å¤©å‰çš„AIæ•°æ®...")
        
        cutoff_date = datetime.now() - timedelta(days=days_to_keep)
        
        # æ¸…ç†é¢„æµ‹ç»“æœ
        if ai_settings.ai_trend_prediction_enabled:
            from app.models.ai_monitoring import AIPrediction
            deleted_count = await AIPrediction.filter(
                created_at__lt=cutoff_date,
                status='completed'
            ).delete()
            logger.info(f"  - æ¸…ç†äº† {deleted_count} æ¡é¢„æµ‹è®°å½•")
        
        # æ¸…ç†åˆ†æç»“æœ
        if ai_settings.ai_smart_analysis_enabled:
            from app.models.ai_monitoring import AIAnalysis
            deleted_count = await AIAnalysis.filter(
                created_at__lt=cutoff_date,
                status='completed'
            ).delete()
            logger.info(f"  - æ¸…ç†äº† {deleted_count} æ¡åˆ†æè®°å½•")
        
        logger.success("AIæ•°æ®æ¸…ç†å®Œæˆ")
```

---

## 6. å®æ–½æ–¹æ¡ˆ

### 6.1 å®æ–½æ­¥éª¤

#### é˜¶æ®µ1: é…ç½®å’Œæ¡†æ¶ (2å¤©)

**Day 1**:
- [ ] åˆ›å»º `app/settings/ai_settings.py`
- [ ] åˆ›å»º `app/ai_module/loader.py`
- [ ] åˆ›å»º `app/ai_module/__init__.py`
- [ ] ä¿®æ”¹ `.env` æ·»åŠ AIé…ç½®é¡¹
- [ ] æµ‹è¯•é…ç½®åŠ è½½

**Day 2**:
- [ ] é›†æˆåˆ° `app/core/init_app.py`
- [ ] å®ç°æ¡ä»¶è·¯ç”±æ³¨å†Œ
- [ ] å®ç°èµ„æºé™åˆ¶å™¨
- [ ] æµ‹è¯•æ¨¡å—å¯ç”¨/ç¦ç”¨

#### é˜¶æ®µ2: é‡æ„ç°æœ‰ä»£ç  (3å¤©)

**Day 3-4**:
- [ ] ç§»åŠ¨AIç›¸å…³ä»£ç åˆ° `app/ai_module/`
- [ ] é‡æ„AI APIè·¯ç”±åˆ° `app/api/v2/ai/`
- [ ] é‡æ„AIæœåŠ¡åˆ° `app/services/ai/`
- [ ] æ›´æ–°å¯¼å…¥è·¯å¾„

**Day 5**:
- [ ] å®ç°å»¶è¿ŸåŠ è½½é€»è¾‘
- [ ] æ·»åŠ åŠŸèƒ½å¼€å…³æ£€æŸ¥
- [ ] æµ‹è¯•å„ä¸ªåŠŸèƒ½æ¨¡å—

#### é˜¶æ®µ3: å‰ç«¯é›†æˆ (2å¤©)

**Day 6**:
- [ ] åˆ›å»º `web/src/store/modules/ai-module.js`
- [ ] å®ç°åŠ¨æ€è·¯ç”±åŠ è½½
- [ ] å®ç°èœå•åŠ¨æ€æ˜¾ç¤º
- [ ] æ·»åŠ åŠŸèƒ½å¼€å…³API

**Day 7**:
- [ ] å‰ç«¯UIä¼˜åŒ–ï¼ˆæ˜¾ç¤ºAIæ¨¡å—çŠ¶æ€ï¼‰
- [ ] æ·»åŠ åŠŸèƒ½æœªå¯ç”¨æç¤º
- [ ] æµ‹è¯•å‰åç«¯é›†æˆ

#### é˜¶æ®µ4: æµ‹è¯•å’Œæ–‡æ¡£ (2å¤©)

**Day 8**:
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå†…å­˜ã€CPUï¼‰

**Day 9**:
- [ ] ç¼–å†™éƒ¨ç½²æ–‡æ¡£
- [ ] ç¼–å†™é…ç½®è¯´æ˜
- [ ] ç¼–å†™å‡çº§æŒ‡å—

### 6.2 å›å½’æµ‹è¯•æ¸…å•

| æµ‹è¯•åœºæ™¯ | AIå¯ç”¨ | AIç¦ç”¨ | é¢„æœŸç»“æœ |
|---------|--------|--------|---------|
| ç³»ç»Ÿå¯åŠ¨ | âœ… | âœ… | å¯åŠ¨æˆåŠŸ |
| æ ¸å¿ƒåŠŸèƒ½ | âœ… | âœ… | æ­£å¸¸å·¥ä½œ |
| AI APIè°ƒç”¨ | âœ… | âŒ | è¿”å›404æˆ–åŠŸèƒ½æœªå¯ç”¨ |
| AIèœå•æ˜¾ç¤º | âœ… | âŒ | èœå•éšè— |
| å†…å­˜å ç”¨ | ~1GB | ~300MB | AIç¦ç”¨æ—¶å‡å°‘70% |
| CPUå ç”¨ | ~20% | ~5% | AIç¦ç”¨æ—¶å‡å°‘75% |
| æ•°æ®åº“è¡¨ | å…¨éƒ¨åˆ›å»º | ä»…æ ¸å¿ƒè¡¨ | AIè¡¨å¯é€‰åˆ›å»º |

---

## 7. éƒ¨ç½²é…ç½®

### 7.1 ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹

#### 7.1.1 å®Œæ•´å¯ç”¨AI (å¤§å‹éƒ¨ç½²)

```bash
# .env.production

# AIæ¨¡å— - å®Œæ•´å¯ç”¨
AI_MODULE_ENABLED=true
AI_FEATURE_EXTRACTION_ENABLED=true
AI_ANOMALY_DETECTION_ENABLED=true
AI_TREND_PREDICTION_ENABLED=true
AI_HEALTH_SCORING_ENABLED=true
AI_SMART_ANALYSIS_ENABLED=true
AI_DATA_ANNOTATION_ENABLED=true

# èµ„æºé…ç½® (æœåŠ¡å™¨: 16æ ¸, 32GBå†…å­˜)
AI_MAX_MEMORY_MB=8192        # 8GB
AI_MAX_CPU_PERCENT=50        # 8æ ¸
AI_WORKER_THREADS=8

# ä¾èµ–æœåŠ¡
AI_REQUIRE_GPU=true          # ä½¿ç”¨GPUåŠ é€Ÿ
AI_REQUIRE_CELERY=true       # ä½¿ç”¨Celeryå¼‚æ­¥ä»»åŠ¡

# åå°ä»»åŠ¡
AI_BACKGROUND_TASKS_ENABLED=true
AI_TASK_SCHEDULE_INTERVAL=300
```

#### 7.1.2 éƒ¨åˆ†å¯ç”¨AI (ä¸­å‹éƒ¨ç½²)

```bash
# .env.production

# AIæ¨¡å— - ä»…æ ¸å¿ƒåŠŸèƒ½
AI_MODULE_ENABLED=true
AI_FEATURE_EXTRACTION_ENABLED=true
AI_ANOMALY_DETECTION_ENABLED=true
AI_TREND_PREDICTION_ENABLED=false    # âŒ ç¦ç”¨
AI_HEALTH_SCORING_ENABLED=true
AI_SMART_ANALYSIS_ENABLED=false      # âŒ ç¦ç”¨
AI_DATA_ANNOTATION_ENABLED=false     # âŒ ç¦ç”¨

# èµ„æºé…ç½® (æœåŠ¡å™¨: 8æ ¸, 16GBå†…å­˜)
AI_MAX_MEMORY_MB=2048        # 2GB
AI_MAX_CPU_PERCENT=25        # 2æ ¸
AI_WORKER_THREADS=4

# ä¾èµ–æœåŠ¡
AI_REQUIRE_GPU=false
AI_REQUIRE_CELERY=false

# åå°ä»»åŠ¡
AI_BACKGROUND_TASKS_ENABLED=true
AI_TASK_SCHEDULE_INTERVAL=600
```

#### 7.1.3 å®Œå…¨ç¦ç”¨AI (å°å‹éƒ¨ç½²)

```bash
# .env.production

# AIæ¨¡å— - å®Œå…¨ç¦ç”¨
AI_MODULE_ENABLED=false

# å…¶ä»–é…ç½®ä¸éœ€è¦è®¾ç½®ï¼Œå› ä¸ºæ¨¡å—ä¸ä¼šåŠ è½½
```

### 7.2 Dockeréƒ¨ç½²é…ç½®

#### 7.2.1 Docker Compose (AIå¯ç”¨)

```yaml
# docker-compose.ai-enabled.yml

version: '3.8'

services:
  backend:
    image: devicemonitor-backend:latest
    environment:
      # AIæ¨¡å—é…ç½®
      AI_MODULE_ENABLED: "true"
      AI_MAX_MEMORY_MB: "2048"
      AI_MAX_CPU_PERCENT: "50"
      
    # èµ„æºé™åˆ¶
    deploy:
      resources:
        limits:
          cpus: '4.0'
          memory: 8G
        reservations:
          cpus: '2.0'
          memory: 4G
    
    volumes:
      - ai-models:/data/ai_models      # AIæ¨¡å‹å­˜å‚¨
      
  # Celery (AIå¼‚æ­¥ä»»åŠ¡)
  celery-worker:
    image: devicemonitor-backend:latest
    command: celery -A app.ai_module.celery_app worker --loglevel=info
    environment:
      AI_MODULE_ENABLED: "true"
    depends_on:
      - redis
      - backend

volumes:
  ai-models:
```

#### 7.2.2 Docker Compose (AIç¦ç”¨)

```yaml
# docker-compose.ai-disabled.yml

version: '3.8'

services:
  backend:
    image: devicemonitor-backend:latest
    environment:
      # AIæ¨¡å—é…ç½®
      AI_MODULE_ENABLED: "false"
      
    # èµ„æºé™åˆ¶ (æ›´å°‘èµ„æº)
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 2G
  
  # ä¸éœ€è¦Celery worker
```

### 7.3 åŠ¨æ€åˆ‡æ¢

#### 7.3.1 åœ¨çº¿å¯ç”¨AIæ¨¡å— (æ— éœ€é‡å¯)

```python
# scripts/enable_ai_module.py

import asyncio
from app.settings.ai_settings import ai_settings
from app.ai_module.loader import ai_loader
from app.core.database import get_db


async def enable_ai_module():
    """åœ¨çº¿å¯ç”¨AIæ¨¡å—"""
    print("å¼€å§‹å¯ç”¨AIæ¨¡å—...")
    
    # 1. æ›´æ–°é…ç½®
    async with get_db() as db:
        await db.execute(
            "INSERT INTO t_sys_config (key, value) "
            "VALUES ('AI_MODULE_ENABLED', 'true') "
            "ON CONFLICT (key) DO UPDATE SET value = 'true'"
        )
    
    # 2. é‡æ–°åŠ è½½é…ç½®
    ai_settings.__init__()
    
    # 3. åŠ è½½AIæ¨¡å—
    success = ai_loader.load_module()
    
    if success:
        print("âœ… AIæ¨¡å—å¯ç”¨æˆåŠŸ")
    else:
        print("âŒ AIæ¨¡å—å¯ç”¨å¤±è´¥")


if __name__ == '__main__':
    asyncio.run(enable_ai_module())
```

#### 7.3.2 ç®¡ç†ç•Œé¢ (å‰ç«¯)

```vue
<!-- web/src/views/system/ai-module-config.vue -->

<template>
  <n-card title="AIæ¨¡å—é…ç½®">
    <n-form>
      <n-form-item label="å¯ç”¨AIæ¨¡å—">
        <n-switch 
          v-model:value="config.enabled"
          @update:value="handleToggle"
        >
          <template #checked>å¯ç”¨</template>
          <template #unchecked>ç¦ç”¨</template>
        </n-switch>
      </n-form-item>
      
      <n-divider />
      
      <!-- ç»†åˆ†åŠŸèƒ½å¼€å…³ -->
      <n-form-item label="ç‰¹å¾æå–">
        <n-switch v-model:value="config.features.feature_extraction" />
      </n-form-item>
      
      <n-form-item label="å¼‚å¸¸æ£€æµ‹">
        <n-switch v-model:value="config.features.anomaly_detection" />
      </n-form-item>
      
      <n-form-item label="è¶‹åŠ¿é¢„æµ‹">
        <n-switch v-model:value="config.features.trend_prediction" />
      </n-form-item>
      
      <n-form-item label="å¥åº·è¯„åˆ†">
        <n-switch v-model:value="config.features.health_scoring" />
      </n-form-item>
      
      <n-form-item label="æ™ºèƒ½åˆ†æ">
        <n-switch v-model:value="config.features.smart_analysis" />
      </n-form-item>
    </n-form>
    
    <template #footer>
      <n-button type="primary" @click="handleSave">ä¿å­˜é…ç½®</n-button>
      <n-button @click="handleReload">é‡æ–°åŠ è½½æ¨¡å—</n-button>
    </template>
  </n-card>
</template>

<script setup>
import { ref } from 'vue'
import { useMessage } from 'naive-ui'
import { apiV2 } from '@/api/v2'

const message = useMessage()

const config = ref({
  enabled: false,
  features: {
    feature_extraction: false,
    anomaly_detection: false,
    trend_prediction: false,
    health_scoring: false,
    smart_analysis: false
  }
})

async function handleToggle(value) {
  if (value) {
    // å¯ç”¨AIæ¨¡å—
    const confirmed = await confirm('å¯ç”¨AIæ¨¡å—å°†å¢åŠ ç³»ç»Ÿèµ„æºæ¶ˆè€—ï¼Œç¡®è®¤å¯ç”¨ï¼Ÿ')
    if (!confirmed) {
      config.value.enabled = false
      return
    }
  } else {
    // ç¦ç”¨AIæ¨¡å—
    const confirmed = await confirm('ç¦ç”¨AIæ¨¡å—å°†åœæ­¢æ‰€æœ‰AIåŠŸèƒ½ï¼Œç¡®è®¤ç¦ç”¨ï¼Ÿ')
    if (!confirmed) {
      config.value.enabled = true
      return
    }
  }
}

async function handleSave() {
  try {
    await apiV2.system.updateModuleConfig('ai_module', config.value)
    message.success('é…ç½®å·²ä¿å­˜')
  } catch (error) {
    message.error('ä¿å­˜å¤±è´¥: ' + error.message)
  }
}

async function handleReload() {
  try {
    await apiV2.system.reloadModule('ai_module')
    message.success('æ¨¡å—å·²é‡æ–°åŠ è½½')
    window.location.reload()  // åˆ·æ–°é¡µé¢
  } catch (error) {
    message.error('é‡æ–°åŠ è½½å¤±è´¥: ' + error.message)
  }
}
</script>
```

---

## 8. æ€»ç»“

### 8.1 è®¾è®¡ä¼˜åŠ¿

| æ–¹é¢ | ä¼˜åŠ¿ |
|------|------|
| **æ¨¡å—åŒ–** | AIåŠŸèƒ½å®Œå…¨ç‹¬ç«‹ï¼Œå¯å•ç‹¬å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½² |
| **å¯é…ç½®** | å¤šçº§å¼€å…³æ§åˆ¶ï¼Œæ»¡è¶³ä¸åŒç”Ÿäº§ç¯å¢ƒéœ€æ±‚ |
| **èµ„æºä¼˜åŒ–** | AIç¦ç”¨æ—¶èŠ‚çœ70%+å†…å­˜ã€75%+CPU |
| **æ˜“ç»´æŠ¤** | æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œï¼Œä¾¿äºå›¢é˜Ÿåä½œ |
| **å¯æ‰©å±•** | æ˜“äºæ·»åŠ æ–°çš„AIåŠŸèƒ½ |
| **é™çº§å‹å¥½** | AIæ•…éšœä¸å½±å“æ ¸å¿ƒä¸šåŠ¡ |

### 8.2 é€‚ç”¨åœºæ™¯

#### åœºæ™¯1: å¤§å‹ä¼ä¸š (æ¨èå®Œæ•´å¯ç”¨)
- æœåŠ¡å™¨èµ„æºå……è¶³ (16æ ¸+, 32GB+)
- éœ€è¦å®Œæ•´AIåŠŸèƒ½
- é…ç½®: `AI_MODULE_ENABLED=true`, æ‰€æœ‰åŠŸèƒ½å¯ç”¨

#### åœºæ™¯2: ä¸­å°ä¼ä¸š (æ¨èéƒ¨åˆ†å¯ç”¨)
- æœåŠ¡å™¨èµ„æºæœ‰é™ (8æ ¸, 16GB)
- åªéœ€æ ¸å¿ƒAIåŠŸèƒ½ (å¼‚å¸¸æ£€æµ‹ã€å¥åº·è¯„åˆ†)
- é…ç½®: é€‰æ‹©æ€§å¯ç”¨éƒ¨åˆ†åŠŸèƒ½

#### åœºæ™¯3: åˆåˆ›å…¬å¸ (æ¨èå®Œå…¨ç¦ç”¨)
- æœåŠ¡å™¨èµ„æºç´§å¼  (4æ ¸, 8GB)
- æš‚ä¸éœ€è¦AIåŠŸèƒ½
- é…ç½®: `AI_MODULE_ENABLED=false`

### 8.3 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **è¯„å®¡æœ¬æ–¹æ¡ˆ** (1å¤©)
   - å›¢é˜Ÿè¯„å®¡è®¾è®¡æ–¹æ¡ˆ
   - ç¡®è®¤å®æ–½è®¡åˆ’

2. **å®æ–½æ¨¡å—åŒ–** (7å¤©)
   - æŒ‰ç…§å®æ–½æ­¥éª¤æ‰§è¡Œ
   - è¾¹å¼€å‘è¾¹æµ‹è¯•

3. **Phase 4å¼€å‘** (2-3å‘¨)
   - åœ¨æ¨¡å—åŒ–æ¡†æ¶åŸºç¡€ä¸Šå¼€å‘AIç‰¹å¾æå–
   - å¼€å‘å…¶ä»–AIåŠŸèƒ½

---

**é™„å½•**:
- ğŸ“„ é…ç½®æ–‡ä»¶æ¨¡æ¿
- ğŸ“„ éƒ¨ç½²æ£€æŸ¥æ¸…å•
- ğŸ“„ æ•…éšœæ’æŸ¥æŒ‡å—
- ğŸ“„ æ€§èƒ½åŸºå‡†æµ‹è¯•æŠ¥å‘Š

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-04  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸

