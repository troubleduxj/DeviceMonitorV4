# 快速部署指南 - 数据模型管理模块

> **更新日期**: 2025-11-03  
> **适用版本**: Phase 3 前端界面开发

---

## 🚀 一键部署步骤

### 步骤 1: 检查后端API (已完成)

✅ 后端API已在 Phase 1 和 Phase 2 完成，无需额外操作。

验证后端API:
```bash
curl http://localhost:8000/api/v2/metadata/models
```

---

### 步骤 2: 执行数据库菜单脚本 ⭐ **必须执行**

**方法 1: 使用Python脚本（推荐）**

```bash
cd database/migrations/device-data-model
python execute_menu_migration.py
```

**方法 2: 使用psql**

```bash
cd database/migrations/device-data-model
psql -h 127.0.0.1 -U postgres -d devicemonitor -f 008_create_frontend_menu.sql
```

**验证菜单创建**:
```sql
-- 查看创建的菜单
SELECT id, name, path FROM t_menu WHERE path LIKE '/data-model%';

-- 应该返回4条记录：
-- 1. /data-model (父菜单)
-- 2. /data-model/config
-- 3. /data-model/mapping
-- 4. /data-model/preview
```

---

### 步骤 3: 启动前端服务

```bash
cd web
npm run dev
# 或
pnpm dev
```

访问: http://localhost:5173 (或您配置的端口)

---

### 步骤 4: 验证功能

#### 4.1 登录系统
- 使用 admin 账号登录
- 默认账号密码见系统配置

#### 4.2 查看菜单
- 左侧菜单应该显示 "数据模型管理"
- 展开后有3个子菜单

#### 4.3 测试功能
1. **模型配置管理** (`/data-model/config`)
   - 查看模型列表
   - 创建新模型
   
2. **字段映射管理** (`/data-model/mapping`)
   - 查看字段映射
   - 创建新映射
   
3. **预览与测试** (`/data-model/preview`)
   - 选择模型
   - 执行查询

---

## 📂 文件清单

### 已创建的文件

```
DeviceMonitorV2/
├── database/migrations/device-data-model/
│   ├── 008_create_frontend_menu.sql       ← 数据库菜单SQL
│   └── execute_menu_migration.py          ← Python执行脚本
│
├── web/src/
│   ├── views/data-model/
│   │   ├── config/index.vue               ← 模型配置管理页面
│   │   ├── mapping/index.vue              ← 字段映射管理页面
│   │   ├── preview/index.vue              ← 数据预览页面
│   │   ├── route.js                       ← 路由配置
│   │   └── README.md                      ← 模块说明
│   │
│   ├── api/v2/
│   │   └── data-model.js                  ← API客户端
│   │
│   └── components/data-model/
│       └── README.md                      ← 组件说明
│
└── docs/device-data-model/
    ├── Phase3实施指南.md                   ← 实施指南
    ├── Phase3完成报告.md                   ← 完成报告
    └── 快速部署指南.md                     ← 本文件
```

**总计**: 12个文件，约2,561行代码

---

## ⚙️ 环境要求

### 后端要求
- ✅ Python 3.9+
- ✅ PostgreSQL 12+
- ✅ FastAPI 后端服务运行中
- ✅ Phase 1 和 Phase 2 已完成

### 前端要求
- ✅ Node.js 16+
- ✅ npm 或 pnpm
- ✅ Vue 3
- ✅ Naive UI

---

## 🐛 故障排查

### 问题 1: 菜单不显示

**症状**: 登录后看不到"数据模型管理"菜单

**解决方法**:

1. 检查数据库菜单是否创建:
```sql
SELECT * FROM t_menu WHERE path LIKE '/data-model%';
```

2. 检查用户权限:
```sql
SELECT m.* 
FROM t_role_menu rm
JOIN t_menu m ON rm.menu_id = m.id
JOIN t_role r ON rm.role_id = r.id
WHERE r.role_code = 'admin';
```

3. 清除浏览器缓存，重新登录

---

### 问题 2: API调用失败

**症状**: 页面显示"查询失败"或网络错误

**解决方法**:

1. 检查后端服务是否运行:
```bash
curl http://localhost:8000/api/v2/metadata/models
```

2. 检查API文档:
```
访问: http://localhost:8000/docs
```

3. 查看浏览器控制台网络请求

---

### 问题 3: 数据库连接失败

**症状**: 执行菜单脚本时报错 "Connection refused"

**解决方法**:

1. 检查PostgreSQL服务:
```bash
# Windows
net start postgresql-x64-14

# Linux/Mac
sudo systemctl start postgresql
```

2. 测试连接:
```bash
psql -h 127.0.0.1 -U postgres -c "SELECT version();"
```

3. 检查配置文件中的数据库密码

---

## 📋 功能测试清单

### 模型配置管理 (/data-model/config)

- [ ] 查看模型列表
- [ ] 搜索模型（关键词）
- [ ] 筛选模型（设备类型、模型类型）
- [ ] 新建模型
- [ ] 编辑模型
- [ ] 删除模型
- [ ] 激活/停用模型
- [ ] 分页功能

### 字段映射管理 (/data-model/mapping)

- [ ] 查看映射列表
- [ ] 搜索映射（字段名、列名）
- [ ] 筛选映射（设备类型、TDengine表）
- [ ] 新增映射
- [ ] 编辑映射
- [ ] 删除映射
- [ ] 配置转换规则（6种类型）
- [ ] 分页功能

### 数据预览 (/data-model/preview)

- [ ] 选择数据模型
- [ ] 配置查询参数（设备、时间范围）
- [ ] 执行实时查询
- [ ] 执行统计查询（时间间隔、分组）
- [ ] 查看表格结果
- [ ] 查看图表结果（统计类型）
- [ ] 预览SQL
- [ ] 复制SQL
- [ ] 导出数据（CSV）
- [ ] 查看执行日志

---

## 🎯 性能指标

### 前端性能
- 页面首次加载: < 2s
- 路由切换: < 500ms
- API请求响应: < 2s
- 图表渲染: < 1s

### 后端性能
- 元数据查询: < 100ms
- 实时数据查询: < 2s
- 统计数据查询: < 5s
- 并发查询支持: > 100 QPS

---

## 📚 相关文档

### 设计文档
- [00-设计方案总览](./00-设计方案总览.md)
- [02-架构设计](./02-架构设计.md)
- [06-实施计划](./06-实施计划.md)

### 实施文档
- [Phase1完成报告](./Phase1完成报告.md)
- [Phase2完成报告](./Phase2完成报告.md)
- [Phase3实施指南](./Phase3实施指南.md)
- [Phase3完成报告](./Phase3完成报告.md)

### API文档
- [API接口文档](./API接口文档.md)

---

## ✅ 验收标准

### 基本功能
- [x] 菜单正常显示
- [ ] 三个页面都能正常访问
- [ ] API调用正常
- [ ] 数据CRUD正常
- [ ] 查询预览正常

### 用户体验
- [x] 界面美观
- [x] 操作流畅
- [x] 错误提示友好
- [x] 加载状态清晰

### 代码质量
- [x] 代码规范
- [x] 注释完整
- [x] 组件复用
- [x] 错误处理

---

## 🎉 部署成功！

如果以上步骤都完成，您应该能够：

1. ✅ 在左侧菜单看到"数据模型管理"
2. ✅ 访问三个子页面
3. ✅ 执行CRUD操作
4. ✅ 查询和预览数据

---

## 📞 需要帮助？

### 技术支持
- 查看 [Phase3完成报告](./Phase3完成报告.md)
- 查看 [实施检查清单](./实施检查清单.md)

### 下一步
- Phase 4: AI集成与优化
- Phase 5: 测试与上线

---

**祝您部署顺利！** 🚀

