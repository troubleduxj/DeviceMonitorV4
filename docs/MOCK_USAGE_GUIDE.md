# Mock数据管理功能使用指南

## 📖 功能概述

Mock数据管理功能允许您拦截前端API请求并返回模拟数据，无需依赖真实的后端服务。这在以下场景非常有用：
- 后端API尚未开发完成
- 测试异常场景（如网络延迟、错误响应）
- 前后端并行开发
- 演示和培训

## 🚀 快速开始

### 1. 访问Mock管理页面

登录系统后，导航至：**高级设置 → Mock数据管理**

### 2. 启用Mock功能

点击页面右上角的 **"启用Mock"** 按钮，状态标签会变为绿色 ✅ "Mock已启用"

### 3. 添加Mock规则

#### 步骤：
1. 点击 **"添加规则"** 按钮
2. 填写规则信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| 规则名称 | Mock规则的名称 | `用户列表Mock` |
| URL匹配 | 支持正则表达式 | `/api/v2/users.*` |
| 请求方法 | GET/POST/PUT/DELETE/PATCH | `GET` |
| 响应状态码 | HTTP状态码 | `200` |
| 响应数据 | JSON格式的响应数据 | 见下方示例 |
| 延迟时间 | 模拟网络延迟（毫秒） | `500` |
| 优先级 | 数字越大优先级越高 | `10` |
| 是否启用 | 开关控制 | `开启` |

#### 响应数据示例：

```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "list": [
      {
        "id": 1,
        "username": "admin",
        "nickname": "管理员"
      },
      {
        "id": 2,
        "username": "user1",
        "nickname": "用户1"
      }
    ],
    "total": 2
  }
}
```

3. 点击 **"确定"** 保存规则

## 🎯 功能详解

### URL匹配规则

支持以下几种匹配方式：

1. **精确匹配**
   ```
   /api/v2/users/1
   ```

2. **通配符匹配**
   ```
   /api/v2/users.*      # 匹配所有users相关接口
   /api/v2/.*/detail    # 匹配所有detail接口
   ```

3. **正则表达式**
   ```
   /api/v2/users/\d+    # 匹配 /api/v2/users/123
   ```

### 优先级规则

当多个Mock规则匹配同一个请求时：
1. 优先匹配**优先级数值更大**的规则
2. 优先级相同时，匹配**最先添加**的规则
3. 只有**启用状态**的规则才会生效

### 延迟设置

模拟网络延迟，帮助测试加载状态：
- `0ms` - 立即响应
- `500ms` - 模拟快速网络
- `2000ms` - 模拟慢速网络
- `5000ms+` - 模拟超时场景

## 🛠️ 高级功能

### 1. 批量操作

- **搜索过滤**：支持按URL、名称、方法、状态筛选
- **快速启用/禁用**：点击开关即可切换规则状态
- **命中统计**：查看每个规则被使用的次数

### 2. 测试规则

点击规则的 **"测试"** 按钮，可以预览：
- URL匹配规则
- 响应状态码
- 响应数据格式
- 延迟设置

### 3. 控制台调试

打开浏览器控制台（F12），使用以下命令：

```javascript
// 查看Mock状态
window.__mockInterceptor.getStats()

// 启用Mock
window.__mockInterceptor.enable()

// 禁用Mock
window.__mockInterceptor.disable()

// 切换Mock状态
window.__mockInterceptor.toggle()

// 重新加载规则
window.__mockInterceptor.reload()
```

## 📝 实用示例

### 示例1：模拟用户登录

```javascript
规则名称: 模拟登录成功
URL匹配: /api/v2/auth/login
方法: POST
状态码: 200
响应数据:
{
  "success": true,
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "mock-jwt-token-12345",
    "user": {
      "id": 1,
      "username": "admin",
      "nickname": "超级管理员"
    }
  }
}
延迟: 300ms
```

### 示例2：模拟列表数据

```javascript
规则名称: 设备列表Mock
URL匹配: /api/v2/devices.*
方法: GET
状态码: 200
响应数据:
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "设备A",
        "status": "online",
        "temperature": 25.5
      },
      {
        "id": 2,
        "name": "设备B",
        "status": "offline",
        "temperature": 0
      }
    ],
    "total": 2,
    "page": 1,
    "pageSize": 10
  }
}
延迟: 500ms
```

### 示例3：模拟错误响应

```javascript
规则名称: 模拟权限错误
URL匹配: /api/v2/admin/.*
方法: GET
状态码: 403
响应数据:
{
  "success": false,
  "code": 403,
  "message": "没有权限访问该资源",
  "data": null
}
延迟: 100ms
```

### 示例4：模拟网络超时

```javascript
规则名称: 模拟超时
URL匹配: /api/v2/slow-api
方法: GET
状态码: 504
响应数据:
{
  "success": false,
  "code": 504,
  "message": "请求超时",
  "data": null
}
延迟: 10000ms
```

## ⚠️ 注意事项

1. **生产环境禁用**
   - Mock功能仅用于开发和测试
   - 部署到生产环境前务必禁用所有Mock规则

2. **JSON格式验证**
   - 响应数据必须是有效的JSON格式
   - 系统会自动验证JSON语法

3. **性能影响**
   - Mock拦截器会检查每个请求
   - 建议仅启用需要的规则

4. **规则冲突**
   - 避免创建相互冲突的规则
   - 使用优先级控制规则匹配顺序

5. **浏览器缓存**
   - 修改规则后建议刷新页面
   - 或使用"刷新"按钮重新加载规则

## 🔧 故障排除

### 问题1：Mock规则不生效

**解决方案：**
1. 检查Mock全局开关是否启用
2. 检查规则的启用状态
3. 检查URL匹配规则是否正确
4. 打开控制台查看拦截日志

### 问题2：响应数据格式错误

**解决方案：**
1. 验证JSON格式是否正确
2. 使用在线JSON验证工具检查
3. 查看控制台错误信息

### 问题3：无法保存规则

**解决方案：**
1. 检查必填字段是否填写完整
2. 检查后端服务是否正常运行
3. 查看网络请求响应

### 问题4：页面加载缓慢

**解决方案：**
1. 减少规则数量
2. 禁用不需要的规则
3. 降低延迟时间设置

## 📚 相关文档

- [Mock数据表结构](./database_schema.md)
- [Mock API接口文档](./api_documentation.md)
- [开发者指南](./developer_guide.md)

## 💡 最佳实践

1. **命名规范**
   - 使用清晰的规则名称，如 "用户列表Mock"
   - 包含场景描述，如 "模拟权限错误"

2. **优先级管理**
   - 通用规则：优先级 0-10
   - 特殊规则：优先级 10-50
   - 测试规则：优先级 50-100

3. **响应数据设计**
   - 遵循项目API响应格式
   - 包含完整的数据结构
   - 模拟真实的业务场景

4. **延迟设置**
   - 快速操作：100-300ms
   - 列表查询：300-500ms
   - 复杂计算：500-1000ms
   - 测试超时：5000ms+

5. **规则组织**
   - 按功能模块分组
   - 使用描述字段记录用途
   - 定期清理无用规则

---

**最后更新：** 2025-10-30  
**版本：** 1.0.0  
**维护人员：** 开发团队

