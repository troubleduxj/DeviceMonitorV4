# 路径别名配置说明

## 问题描述

前端启动后报错：
```
Failed to resolve import "@/../packages/shared/utils" from "src/utils/common/shared-compat.js"
```

## 原因分析

Vite 无法识别 `@/../packages/shared` 这种相对路径写法。需要配置路径别名。

## 解决方案

### 1. 更新 Vite 配置

在 `web/vite.config.js` 中添加 `@shared` 别名：

```javascript
resolve: {
  alias: {
    '~': rootPath,
    '@': srcPath,
    // 添加 Shared 层路径别名
    '@shared': getRootPath() + '/../packages/shared',
  },
},
```

### 2. 更新所有导入语句

将所有 `@/../packages/shared` 替换为 `@shared`：

#### 需要更新的文件

1. `web/src/utils/common/shared-compat.js`
   ```javascript
   // 旧：from '@/../packages/shared/utils'
   // 新：from '@shared/utils'
   ```

2. `web/src/utils/shared.ts`
   ```typescript
   // 旧：from '@/../packages/shared/utils'
   // 新：from '@shared/utils'
   ```

3. `web/src/types/shared.ts`
   ```typescript
   // 旧：from '@/../packages/shared/types'
   // 新：from '@shared/types'
   ```

4. `web/src/api/shared.ts`
   ```typescript
   // 旧：from '@/../packages/shared/api'
   // 新：from '@shared/api'
   ```

### 3. 重启开发服务器

```bash
# Ctrl+C 停止当前服务
# 然后重新启动
npm run dev
```

## 路径别名总览

| 别名 | 实际路径 | 用途 |
|------|---------|------|
| `@` | `web/src` | Web 端源码 |
| `~` | `web` | Web 端根目录 |
| `@shared` | `packages/shared` | 跨端共享层 |

## 使用示例

```typescript
// ✅ 正确
import { formatDate } from '@shared/utils'
import type { Device } from '@shared/types'
import { createApiServices } from '@shared/api'

// ❌ 错误
import { formatDate } from '@/../packages/shared/utils'
import type { Device } from '../../../packages/shared/types'
```

## 验证方法

启动开发服务器，检查是否有路径解析错误：

```bash
npm run dev
```

如果看到以下输出，说明配置成功：
```
VITE v5.x.x  ready in xxx ms

➜  Local:   http://localhost:3000/
➜  Network: use --host to expose
```

## 相关文档

- [Vite 路径别名配置](https://vitejs.dev/config/shared-options.html#resolve-alias)
- [Web 端接入 Shared 层指南](./Web端接入Shared层指南.md)

