# 模拟设备Mock数据使用指南

## 📖 概述

本文档介绍如何使用"模拟设备分类"的Mock数据，包括5台虚拟设备的完整数据：基础信息、实时数据和历史数据。

## 🎯 模拟设备清单

### 设备列表（5台）

| 设备编号 | 设备名称 | 设备型号 | 安装位置 | 状态 | 说明 |
|---------|---------|---------|---------|------|------|
| SIM-DEV-001 | 模拟温控设备A | SIM-TC-100 | 模拟车间-A区 | 运行中 | 温度控制设备 |
| SIM-DEV-002 | 模拟压力监测设备B | SIM-PM-200 | 模拟车间-B区 | 运行中 | 压力监测设备 |
| SIM-DEV-003 | 模拟流量计设备C | SIM-FM-300 | 模拟车间-C区 | 运行中 | 流量监测设备 |
| SIM-DEV-004 | 模拟能耗监控设备D | SIM-EM-400 | 模拟车间-D区 | 维护中 | 能耗监控设备 |
| SIM-DEV-005 | 模拟振动传感设备E | SIM-VS-500 | 模拟车间-E区 | 运行中 | 振动监测设备 |

## 📊 数据内容

### 1. 基础信息

每台设备包含：
- **设备标识**：设备ID、设备编号、设备名称
- **设备分类**：设备类型（simulation）、型号、制造商
- **安装信息**：安装位置、团队负责人、在线地址
- **状态信息**：运行状态、锁定状态
- **维护信息**：上次维护日期、下次维护日期
- **采购信息**：采购日期、保修期限
- **规格参数**：温度范围、精度、功率、电压、重量等

### 2. 实时数据

每台设备的实时监测指标：

| 指标 | 单位 | 示例值 | 阈值范围 |
|------|------|--------|---------|
| 温度 | °C | 45.8 | 0-100 |
| 压力 | MPa | 2.3 | 0-5 |
| 流量 | L/min | 125.6 | 0-200 |
| 功耗 | kW | 2.15 | 0-3 |
| 振动 | mm/s | 0.8 | 0-5 |
| 效率 | % | 92.5 | - |

**实时数据特点：**
- ✅ 所有指标都在正常范围内
- ✅ 状态标记为"normal"或"good"
- ✅ 无告警信息
- ✅ 时间戳为当前时间

### 3. 历史数据（2025-10-29全天）

**数据周期：** 2025年10月29日 00:00:00 - 23:59:59

**数据点：** 24个小时点（每小时一个数据点）

**数据趋势：**
- **温度**：42.3°C → 49.0°C → 42.8°C（白天升高，夜间降低）
- **压力**：2.1 → 2.45 → 2.13 MPa（随温度变化）
- **流量**：118.2 → 132.5 → 118.2 L/min（日间流量增大）
- **功耗**：2.0 → 2.26 → 2.02 kW（负载变化）
- **振动**：0.7 → 0.92 → 0.71 mm/s（正常波动）
- **效率**：91.0% → 93.3% → 91.0%（整体保持高效）

**统计信息：**
```json
{
  "total_runtime": 24.0小时,
  "downtime": 0小时,
  "availability": 100%,
  "avg_temperature": 46.1°C,
  "avg_efficiency": 92.2%
}
```

## 🚀 快速开始

### 步骤1：插入Mock规则到数据库

#### 方法A：在pgAdmin中执行（推荐）

1. 打开pgAdmin并连接到 `device_monitor` 数据库
2. 打开查询工具（Query Tool）
3. 打开文件并执行：
   ```
   database/migrations/insert_simulation_device_mocks.sql
   ```

#### 方法B：使用命令行

```bash
cd D:\Cursor\Project\DeviceMonitorV2_20251013_V1\DeviceMonitorV2
psql -h localhost -p 5432 -U postgres -d device_monitor -f database/migrations/insert_simulation_device_mocks.sql
```

### 步骤2：启用Mock规则

1. **刷新浏览器** (Ctrl + Shift + R)
2. **访问Mock管理页面**：高级设置 → Mock数据管理
3. **启用以下规则**：
   - ✅ 模拟设备分类-设备列表
   - ✅ 模拟设备-详情信息
   - ✅ 模拟设备-实时数据
   - ✅ 模拟设备-历史数据
   - ✅ 模拟设备-统计数据

4. **启用Mock全局开关**：点击页面右上角"启用Mock"按钮

### 步骤3：查看模拟设备

1. **访问设备管理**：设备管理 → 设备信息管理
2. **筛选设备类型**：选择"模拟设备"（simulation）
3. **查看设备列表**：应该显示5台模拟设备

## 💡 使用场景

### 场景1：查看设备列表

**API：** `GET /api/v2/devices?device_type=simulation`

**操作：**
1. 进入设备信息管理页面
2. 设备类型选择"模拟设备"
3. 点击查询

**预期结果：**
- 显示5台模拟设备
- 包含设备编号、名称、型号、位置、状态等信息
- 4台运行中，1台维护中

### 场景2：查看设备详情

**API：** `GET /api/v2/devices/1001`

**操作：**
1. 在设备列表中点击某台设备
2. 查看详细信息

**预期结果：**
- 显示完整的设备信息
- 包含规格参数
- 包含维护历史记录

### 场景3：查看实时数据

**API：** `GET /api/v2/devices/1001/realtime`

**操作：**
1. 进入设备详情页面
2. 查看实时监测数据

**预期结果：**
- 显示6个监测指标
- 所有指标状态正常
- 时间戳为当前时间

### 场景4：查看历史数据

**API：** `GET /api/v2/devices/1001/history`

**操作：**
1. 进入设备详情页面
2. 选择历史数据查询
3. 选择日期：2025-10-29

**预期结果：**
- 显示24小时的数据曲线
- 温度、压力、流量等指标的趋势图
- 统计信息（最小值、最大值、平均值）

### 场景5：查看统计数据

**API：** `GET /api/v2/devices/statistics?device_type=simulation`

**操作：**
1. 进入设备统计页面
2. 筛选模拟设备类型

**预期结果：**
- 总设备数：5台
- 在线设备：4台
- 维护设备：1台
- 健康评分：95.8
- 平均效率：92.3%

## 📋 Mock规则清单

| 规则名称 | URL模式 | 方法 | 优先级 | 说明 |
|---------|---------|------|--------|------|
| 模拟设备分类-设备列表 | `/api/v2/devices.*device_type=simulation` | GET | 100 | 5台设备列表 |
| 模拟设备-详情信息 | `/api/v2/devices/100[1-5]$` | GET | 90 | 设备详细信息 |
| 模拟设备-实时数据 | `/api/v2/devices/100[1-5]/realtime` | GET | 100 | 实时监测数据 |
| 模拟设备-历史数据 | `/api/v2/devices/100[1-5]/history` | GET | 100 | 10-29历史数据 |
| 模拟设备-统计数据 | `/api/v2/devices/statistics.*device_type=simulation` | GET | 90 | 统计汇总数据 |

## 🎨 数据可视化示例

### 温度趋势图（2025-10-29）

```
°C
50 |           ╭───╮
48 |         ╭─╯   ╰─╮
46 |       ╭─╯       ╰─╮
44 |     ╭─╯           ╰─╮
42 | ───╯                 ╰───
   +─────────────────────────
     0  4  8 12 16 20 24 (小时)
```

### 效率分布

```
93% ████████████░░ 92.3%
92% ████████████
91% ████████
90% ████
    午夜  早晨  中午  下午
```

## 🔧 高级功能

### 1. 修改Mock数据

如果需要修改模拟数据的值：

1. 访问Mock管理页面
2. 找到对应的规则
3. 点击"编辑"
4. 修改响应数据中的JSON
5. 保存并重新加载规则

### 2. 添加新的设备

在"模拟设备分类-设备列表"规则的响应数据中，在`items`数组中添加新设备：

```json
{
  "id": 1006,
  "device_code": "SIM-DEV-006",
  "device_name": "模拟新设备F",
  "device_type": "simulation",
  // ... 其他字段
}
```

### 3. 修改历史数据日期

将历史数据的日期改为其他日期：

1. 编辑"模拟设备-历史数据"规则
2. 修改`date_range.start`和`date_range.end`
3. 修改每个`data_points`的`timestamp`

### 4. 添加告警数据

在实时数据的`alarms`数组中添加告警：

```json
"alarms": [
  {
    "level": "warning",
    "message": "温度接近上限",
    "timestamp": "2025-10-30T11:50:00Z"
  }
]
```

## ⚠️ 注意事项

1. **Mock数据仅用于开发和演示**
   - 不要在生产环境使用
   - 数据是静态的，不会实时变化

2. **数据一致性**
   - 设备ID范围：1001-1005
   - 历史数据日期：2025-10-29
   - 实时数据时间戳会显示固定值

3. **URL匹配规则**
   - 使用正则表达式匹配
   - `100[1-5]$` 匹配 1001, 1002, 1003, 1004, 1005
   - 确保URL完全匹配才能触发

4. **性能考虑**
   - 历史数据包含24个数据点
   - 响应延迟设置为500ms
   - 大量请求时可能影响页面性能

## 🆘 故障排除

### 问题1：看不到模拟设备

**检查：**
1. Mock规则是否已启用
2. Mock全局开关是否已打开
3. 设备类型筛选是否正确（simulation）

**解决：**
```javascript
// 控制台检查
window.__mockInterceptor.getStats()
// 应该显示 enabled: true, rulesCount: 5
```

### 问题2：历史数据不显示

**检查：**
1. 日期选择是否为 2025-10-29
2. URL是否匹配规则
3. 控制台是否有错误

**解决：**
- 确保选择的日期是2025-10-29
- 或修改Mock规则中的日期范围

### 问题3：数据格式错误

**检查：**
- Mock规则的响应数据JSON格式是否正确
- 是否有语法错误

**解决：**
- 使用JSON验证工具检查
- 点击"测试"按钮预览数据

## 📚 相关文档

- [Mock数据管理功能使用指南](./MOCK_USAGE_GUIDE.md)
- [Mock规则使用指南](./MOCK_RULES_GUIDE.md)
- [设备管理API文档](./api_devices.md)

---

**最后更新：** 2025-10-30  
**版本：** 1.0.0  
**维护人员：** 开发团队

