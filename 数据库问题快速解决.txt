╔════════════════════════════════════════════════════════════════╗
║          数据库连接问题 - 快速解决方案                        ║
╚════════════════════════════════════════════════════════════════╝

【问题】
后端启动报错：connection was closed in the middle of operation

【原因】
PostgreSQL 服务未启动（状态：Stopped）

【快速解决】
┌────────────────────────────────────────────────────────────┐
│ 方案一：一键修复（推荐）                                   │
├────────────────────────────────────────────────────────────┤
│ 1. 右键点击 "一键修复数据库连接.bat"                      │
│ 2. 选择 "以管理员身份运行"                                 │
│ 3. 等待修复完成                                            │
│ 4. 运行 python run.py 启动后端                             │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│ 方案二：手动启动服务                                       │
├────────────────────────────────────────────────────────────┤
│ 1. 右键点击 "启动PostgreSQL服务.bat"                      │
│ 2. 选择 "以管理员身份运行"                                 │
│ 3. 等待服务启动成功                                        │
│ 4. 运行 python run.py 启动后端                             │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│ 方案三：使用 Windows 服务管理器                            │
├────────────────────────────────────────────────────────────┤
│ 1. 按 Win + R，输入 services.msc                           │
│ 2. 找到 "postgresql-x64-17" 服务                          │
│ 3. 右键选择 "启动"                                         │
│ 4. 运行 python run.py 启动后端                             │
└────────────────────────────────────────────────────────────┘

【验证工具】
运行 "检查数据库连接.bat" 可以检查：
  ✓ PostgreSQL 服务状态
  ✓ 端口 5432 监听状态
  ✓ .env 配置文件
  ✓ 数据库连接测试

【预防措施】
设置 PostgreSQL 自动启动，避免下次重启后出现同样问题：
  1. 打开服务管理器 (services.msc)
  2. 找到 postgresql-x64-17 服务
  3. 右键 → 属性 → 启动类型 → 自动
  4. 应用并确定

【相关文件】
  📄 数据库连接问题解决方案.md - 详细文档
  🔧 一键修复数据库连接.bat - 自动修复脚本
  🚀 启动PostgreSQL服务.bat - 启动服务脚本
  🔍 检查数据库连接.bat - 诊断工具
  ⚙️  .env - 数据库配置文件

【数据库配置】
  主机：127.0.0.1
  端口：5432
  数据库：devicemonitor
  用户：postgres
  密码：Hanatech@123

【常见问题】
Q: 提示权限不足？
A: 必须以管理员身份运行批处理脚本

Q: 服务启动失败？
A: 查看日志 D:\Program Files\PostgreSQL\17\data\log\

Q: 端口被占用？
A: 运行 netstat -ano | findstr ":5432" 查看占用进程

Q: 数据库不存在？
A: 后端首次启动会自动创建表结构

【技术支持】
如问题仍未解决，请查看：
  📖 数据库连接问题解决方案.md

╔════════════════════════════════════════════════════════════════╗
║  提示：建议使用"一键修复"方案，最快速便捷！                   ║
╚════════════════════════════════════════════════════════════════╝
